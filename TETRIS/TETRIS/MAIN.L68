00001A74 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 06/12/2019 17:34:33

00000000                             1  ; =============================================================================
00000000                             2  ; TITLE    : TETRIS GAME
00000000                             3  ; AUTHOR   : FELIX AGUILAR FERRER
00000000                             4  ; CREATION :
00000000                             5  ; =============================================================================
00000000                             6  
00001000                             7              ORG     $1000
00001000                             8  
00001000                             9  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            10  
00001000                            11              INCLUDE "SYSTEM/SYSCONST.X68"   ; SYSTEM CONSTANTS
00001000                            12  ; =============================================================================
00001000                            13  ; SYSTEM CONSTANTS
00001000                            14  ; =============================================================================
00001000                            15  
00001000                            16  ; --- TRAP RELATED CONSTANTS --------------------------------------------------
00001000                            17  
00001000  =00000000                 18  KBDTRAP     EQU     0                       ; KEYBOARD UPDATE TRAP
00001000  =00000001                 19  SCRTRAP     EQU     1                       ; SCREEN REFRESH TRAP
00001000                            20  
00001000                            21  ; --- KEY CODES (EASy68K)
00001000                            22  
00001000  =00000020                 23  KBDCHRSP    EQU     $20                     ; SPACE KEY
00001000  =0000004D                 24  KBDCHRMK    EQU     'M'                     ; M KEY
00001000  =00000010                 25  KBDCHRSH    EQU     $10                     ; SHIFT KEY
00001000  =00000050                 26  KBDCHRPK    EQU     'P'                     ; P KEY
00001000  =00000025                 27  KBDCHRLF    EQU     $25                     ; LEFT KEY
00001000  =00000026                 28  KBDCHRUP    EQU     $26                     ; UP KEY
00001000  =00000027                 29  KBDCHRRT    EQU     $27                     ; RIGHT KEY
00001000  =00000028                 30  KBDCHRDN    EQU     $28                     ; DOWN KEY
00001000                            31  
00001000                            32  ; --- KEYBOARD MAPPING --------------------------------------------------------
00001000                            33  
00001000  =00000025                 34  KBDLEFT     EQU     KBDCHRLF                ; LEFT BUTTON
00001000  =00000026                 35  KBDUP       EQU     KBDCHRUP                ; UP BUTTON
00001000  =00000027                 36  KBDRIGHT    EQU     KBDCHRRT                ; RIGHT BUTTON
00001000  =00000028                 37  KBDDOWN     EQU     KBDCHRDN                ; DOWN BUTTON
00001000  =00000020                 38  KBDFIRE1    EQU     KBDCHRSP                ; FIRE 1 BUTTON
00001000  =0000004D                 39  KBDFIRE2    EQU     KBDCHRMK                ; FIRE 2 BUTTON
00001000  =00000010                 40  KBDFIRE3    EQU     KBDCHRSH                ; FIRE 3 BUTTON
00001000  =00000050                 41  KBDPAUSE    EQU     KBDCHRPK                ; PAUSE BUTTON
00001000                            42  
00001000                            43  ; --- KEYBOARD BITFIELD MASKS -------------------------------------------------
00001000                            44  ; CONVENIENCE CONSTANTS TO ACCESS THE FOLLOWING BIT-FIELD.
00001000                            45  ; THIS BIT-FIELD IS USED BY SYSTEM VARS (KBDVAL) AND (KBDEDGE).
00001000                            46  ; +---+---+---+---+---+---+---+---+
00001000                            47  ; | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            48  ; +---+---+---+---+---+---+---+---+
00001000                            49  ;   |   |   |   |   |   |   |   |
00001000                            50  ;   |   |   |   |   |   |   |   +---------- LEFT BUTTON
00001000                            51  ;   |   |   |   |   |   |   +-------------- UP BUTTON
00001000                            52  ;   |   |   |   |   |   +------------------ RIGHT BUTTON
00001000                            53  ;   |   |   |   |   +---------------------- DOWN BUTTON
00001000                            54  ;   |   |   |   +-------------------------- FIRE 1 BUTTON
00001000                            55  ;   |   |   +------------------------------ FIRE 2 BUTTON
00001000                            56  ;   |   +---------------------------------- FIRE 3 BUTTON
00001000                            57  ;   +-------------------------------------- PAUSE BUTTON
00001000                            58  
00001000  =00000001                 59  KBDMSKLF    EQU     %00000001
00001000  =00000002                 60  KBDMSKUP    EQU     %00000010
00001000  =00000004                 61  KBDMSKRT    EQU     %00000100
00001000  =00000008                 62  KBDMSKDN    EQU     %00001000
00001000  =00000010                 63  KBDMSKF1    EQU     %00010000
00001000  =00000020                 64  KBDMSKF2    EQU     %00100000
00001000  =00000040                 65  KBDMSKF3    EQU     %01000000
00001000  =00000080                 66  KBDMSKPS    EQU     %10000000
00001000                            67  
00001000                            68  ; --- KEYBOARD BITFIELD POSITIONS ---------------------------------------------
00001000                            69  
00001000  =00000000                 70  KBDBITLF    EQU     0
00001000  =00000001                 71  KBDBITUP    EQU     1
00001000  =00000002                 72  KBDBITRT    EQU     2
00001000  =00000003                 73  KBDBITDN    EQU     3
00001000  =00000004                 74  KBDBITF1    EQU     4
00001000  =00000005                 75  KBDBITF2    EQU     5
00001000  =00000006                 76  KBDBITF3    EQU     6
00001000  =00000007                 77  KBDBITPS    EQU     7
00001000                            78  
00001000                            79  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            80  
00001000  =000003E8                 81  SCRWIDTH    EQU     1000                    ; SCREEN WIDTH (PIXELS)
00001000  =000002BC                 82  SCRHEIGH    EQU     700                     ; SCREEN HEIGHT (PIXELS)
00001000  =00000001                 83  SCRIRQ      EQU     1                       ; SCREEN INTERRUPT NUMBER
00001000  =00000014                 84  SCRTIM      EQU     20                      ; SCREEN TIMER (MS)
00001000                            85  
00001000                            86  ; --- DYNAMIC MEMORY CONSTANTS ------------------------------------------------
00001000                            87  
00001000  =00000040                 88  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00001000  =00000032                 89  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00001000  =00000000                 90  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00001000                            91  
00001000                            92  
00001000                            93  -------------------- end include --------------------
00001000                            94              INCLUDE "SYSTEM/SYSTEM.X68"     ; SYSTEM CODE
00001000                            95  ; =============================================================================
00001000                            96  ; SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            97  ; =============================================================================
00001000                            98  ; Felix Aguilar Ferrer, Adrian Bennasar Polzin, Alvaro Bueno Lopez
00001000                            99  ; -----------------------------------------------------------------------------
00001000                           100  SYSINIT
00001000                           101  ; INITIALIZES THE SYSTEM
00001000                           102  ; INPUT    - NONE
00001000                           103  ; OUTPUT   - NONE
00001000                           104  ; MODIFIES - NONE
00001000                           105  ; -----------------------------------------------------------------------------
00001000  205F                     106              MOVE.L  (A7)+,A0                ; GET RETURN ADDRESS
00001002  4EB9 000010A8            107              JSR     KBDINIT                 ; INIT KEYBOARD
00001008  4EB9 0000101C            108              JSR     SCRINIT                 ; INIT SCREEN
0000100E  4EB9 0000111A            109              JSR     DMMINIT                 ; INIT DYNAMIC MEMORY
00001014  027C DFFF                110              ANDI.W  #$DFFF,SR               ; SWITCH TO USER
00001018  2F08                     111              MOVE.L  A0,-(A7)                ; PUT RETURN ADDRESS
0000101A  4E75                     112              RTS
0000101C                           113  
0000101C                           114  ; =============================================================================
0000101C                           115  ; SCREEN MANAGEMENT (SYSTEM CODE)
0000101C                           116  ; =============================================================================
0000101C                           117  
0000101C                           118  ; -----------------------------------------------------------------------------
0000101C                           119  SCRINIT
0000101C                           120  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS.
0000101C                           121  ; INPUT    - NONE
0000101C                           122  ; OUTPUT   - NONE
0000101C                           123  ; MODIFIES - WHATEVER IS REQUIRED, NO NEED TO RESTORE REGISTERS.
0000101C                           124  ; -----------------------------------------------------------------------------
0000101C                           125              ; TO DO:
0000101C                           126              ; - DISABLE INTS (SET INT BITS IN SR TO 111)
0000101C  007C 0700                127              ORI.W   #$0700,SR
00001020                           128              
00001020                           129              ; - INSTALL SCRUPD INTO TRAP SCRTRAP
00001020  21FC 00001096 0084       130              MOVE.L  #SCRUPD,($80+SCRTRAP*4)
00001028                           131              
00001028                           132              ; - SET RESOLUTION TO SCRWIDTH X SCRHEIGHT
00001028  103C 0021                133              MOVE.B  #33,D0
0000102C  323C 03E8                134              MOVE.W  #SCRWIDTH,D1
00001030  4841                     135              SWAP.W  D1
00001032  323C 02BC                136              MOVE.W  #SCRHEIGH,D1
00001036  4E4F                     137              TRAP    #15
00001038                           138              
00001038                           139              ; - SET WINDOWED MODE
00001038  7201                     140              MOVEQ.L #1,D1
0000103A  4E4F                     141              TRAP    #15
0000103C                           142              
0000103C                           143              ; - CLEAR VISIBLE BUFFER
0000103C  103C 000B                144              MOVE.B  #11,D0
00001040  323C FF00                145              MOVE.W  #$FF00, D1
00001044  4E4F                     146              TRAP    #15
00001046                           147              
00001046                           148              ; - ENABLE DOUBLE BUFFER
00001046  103C 005C                149              MOVE.B  #92,D0
0000104A  123C 0011                150              MOVE.B  #17,D1
0000104E  4E4F                     151              TRAP    #15
00001050                           152              
00001050                           153              ; - CLEAR HIDDEN BUFFER
00001050  103C 000B                154              MOVE.B  #11,D0
00001054  323C FF00                155              MOVE.W  #$FF00, D1
00001058  4E4F                     156              TRAP    #15
0000105A                           157              
0000105A                           158              ; - INSTALL SCRISR FOR IRQ SCRIRQ (IRQ INTERRUPT VECTOR BEGINS
0000105A                           159              ;   AT $60. INSTALLATION IS SIMILAR TO TRAP INSTALLATION)
0000105A  21FC 00001088 0064       160              MOVE.L  #SCRISR,($60+SCRIRQ*4)
00001062                           161              
00001062                           162              ; - ENABLE AUTO-IRQ EVERY SCRTIM MS FOR IRQ SCRIRQ (SEE TRAP #15
00001062                           163              ;   TASK 32)
00001062  103C 0020                164              MOVE.B  #32,D0
00001066  123C 0006                165              MOVE.B  #06,D1
0000106A  143C 0001                166              MOVE.B  #1,D2
0000106E  EF0A                     167              LSL.B   #7,D2
00001070  5202                     168              ADD.B   #SCRIRQ,D2
00001072  7614                     169              MOVE.L  #SCRTIM,D3
00001074  4E4F                     170              TRAP    #15
00001076                           171              
00001076                           172              ; - CLEAR SCRINTCT AND SCRCYCCT
00001076  4239 00001A9E            173              CLR.B   SCRINTCT
0000107C  4239 00001A9F            174              CLR.B   SCRCYCCT
00001082                           175              
00001082                           176              ; - ENABLE INTS (SET INT BITS IN SR TO 000)
00001082  027C F8FF                177              ANDI.W  #$F8FF,SR
00001086  4E75                     178              RTS
00001088                           179  
00001088                           180  ; -----------------------------------------------------------------------------
00001088                           181  SCRISR
00001088                           182  ; SCREEN TIMER ISR. INCREASES THE INTERRUPT COUNTER AND UPDATES DOUBLE BUFFER.
00001088                           183  ; INPUT    - NONE
00001088                           184  ; OUTPUT   - NONE
00001088                           185  ; MODIFIES - NONE
00001088                           186  ; -----------------------------------------------------------------------------
00001088  5239 00001A9E            187              ADDQ.B  #1,SCRINTCT           ; UPDATE INT FLAG/COUNTER
0000108E  5239 00001A9F            188              ADDQ.B  #1,SCRCYCCT           ; UPDATE CYCLE COUNTER
00001094  4E73                     189              RTE
00001096                           190  
00001096                           191  ; -----------------------------------------------------------------------------
00001096                           192  SCRUPD
00001096                           193  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
00001096                           194  ; BUFFER FOR THE NEXT ONE.
00001096                           195  ; INPUT    - NONE
00001096                           196  ; OUTPUT   - NONE
00001096                           197  ; MODIFIES - NONE
00001096                           198  ; -----------------------------------------------------------------------------
00001096                           199              ; TO DO: UPDATE DOUBLE BUFFER AND CLEAR HIDDEN BUFFER
00001096  103C 005E                200              MOVE.B  #94,D0
0000109A  4E4F                     201              TRAP    #15
0000109C  103C 000B                202              MOVE.B  #11,D0
000010A0  323C FF00                203              MOVE.W  #$FF00,D1
000010A4  4E4F                     204              TRAP    #15
000010A6  4E73                     205              RTE
000010A8                           206  
000010A8                           207  ; =============================================================================
000010A8                           208  ; KEYBOARD MANAGEMENT (SYSTEM CODE)
000010A8                           209  ; =============================================================================
000010A8                           210  
000010A8                           211  ; -----------------------------------------------------------------------------
000010A8                           212  KBDINIT
000010A8                           213  ; INITIALIZES THE SYSTEM VARIABLES KBDSYS AND KBDVAL
000010A8                           214  ; INPUT    - NONE
000010A8                           215  ; OUTPUT   - NONE
000010A8                           216  ; MODIFIES - NONE
000010A8                           217  ; -----------------------------------------------------------------------------
000010A8  4239 00001A9C            218              CLR.B   KBDVAL                ; INIT VARS
000010AE  4239 00001A9D            219              CLR.B   KBDEDGE
000010B4  21FC 000010BE 0080       220              MOVE.L  #KBDREAD,($80+KBDTRAP*4) ; INSTALL
000010BC  4E75                     221              RTS
000010BE                           222  
000010BE                           223  ; -----------------------------------------------------------------------------
000010BE                           224  KBDREAD
000010BE                           225  ; TRAP SERVICE ROUTINE.
000010BE                           226  ; UPDATES THE SYSTEM VARIABLES KBDEDGE AND KBDVAL ACCORDING TO THE BITFIELD
000010BE                           227  ; DESCRIBED IN SYSCONST. KBDVAL HOLDS THE CURRENT VALUES AND KBDEFGE HOLDS
000010BE                           228  ; RISING EDGES FROM PREVIOUS CALL TO THE CURRENT ONE.
000010BE                           229  ; INPUT    - NONE
000010BE                           230  ; OUTPUT   - (KBDVAL) AND (KBDEDGE)
000010BE                           231  ; MODIFIES - NONE
000010BE                           232  ; -----------------------------------------------------------------------------
000010BE                           233              ; TO DO: UPDATE KBDVAL AND KBDEDGE
000010BE  48E7 FC00                234              MOVEM.L D0-D5,-(A7)
000010C2  1A39 00001A9C            235              MOVE.B  KBDVAL,D5               ; D5 = KBDVAL (T-1)
000010C8  4239 00001A9C            236              CLR.B   KBDVAL
000010CE                           237              
000010CE                           238              ; - READ 8 KEYS FROM KEYBBOARD
000010CE  103C 0013                239              MOVE.B  #19,D0
000010D2  223C 50104D20            240              MOVE.L  #KBDPAUSE<<24+KBDFIRE3<<16+KBDFIRE2<<8+KBDFIRE1,D1
000010D8  4E4F                     241              TRAP    #15
000010DA  2601                     242              MOVE.L  D1,D3                   ; D3 = FIRST 4 KEYS
000010DC  223C 28272625            243              MOVE.L  #KBDDOWN<<24+KBDRIGHT<<16+KBDUP<<8+KBDLEFT,D1
000010E2  4E4F                     244              TRAP    #15
000010E4                           245              
000010E4                           246              ; - UPDATE KBDVAL FROM VALUES OBTEINED FROM THE KEYBOARD
000010E4  143C 0001                247              MOVE.B  #KBDMSKLF,D2            ; D0 = MASK FOR THE KEY 0
000010E8  383C 0007                248              MOVE.W  #7,D4                   ; D4 = COUNT OF INTERACTIONS
000010EC  C202                     249  .LOOP       AND.B   D2,D1
000010EE  8339 00001A9C            250              OR.B    D1,KBDVAL               ; UPDATES 1 KEY AT A TIME.
000010F4  E089                     251              LSR.L   #8,D1                   ; MODIFIES D1 TO GET NEXT KEY INFO
000010F6  E30A                     252              LSL.B   #1,D2                   ; MODIFIES MASK FOR THE NEXT KEY
000010F8  B43C 0010                253              CMP.B   #KBDMSKF1,D2            ; WHEN REACHED KEY 4 DO NOT JUMP
000010FC  6600 0004                254              BNE     .SKIP
00001100  2203                     255              MOVE.L  D3,D1                   ; LOADS NEXT 4 KEYS
00001102  51CC FFE8                256  .SKIP       DBRA    D4,.LOOP            
00001106                           257                                      
00001106                           258              ; - UPDATE KBDEDGE
00001106  4605                     259              NOT.B   D5
00001108  CA39 00001A9C            260              AND.B   KBDVAL,D5
0000110E  13C5 00001A9D            261              MOVE.B  D5,KBDEDGE
00001114                           262              
00001114  4CDF 003F                263              MOVEM.L (A7)+,D0-D5
00001118  4E73                     264              RTE
0000111A                           265  
0000111A                           266  ; =============================================================================
0000111A                           267  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
0000111A                           268  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
0000111A                           269  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
0000111A                           270  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
0000111A                           271  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
0000111A                           272  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
0000111A                           273  ; =============================================================================
0000111A                           274  
0000111A                           275  ; -----------------------------------------------------------------------------
0000111A                           276  DMMINIT
0000111A                           277  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
0000111A                           278  ; INPUT    - NONE
0000111A                           279  ; OUTPUT   - NONE
0000111A                           280  ; MODIFIES - NONE
0000111A                           281  ; -----------------------------------------------------------------------------
0000111A  48E7 8080                282              MOVEM.L D0/A0,-(A7)
0000111E  41F9 00001AC0            283              LEA     DMMDATA,A0
00001124  303C 0031                284              MOVE.W  #DMMBNUM-1,D0
00001128  30BC 0000                285  .LOOP       MOVE.W  #DMMSYSID,(A0)
0000112C  D1FC 00000040            286              ADD.L   #DMMBSIZE,A0
00001132  51C8 FFF4                287              DBRA.W  D0,.LOOP
00001136  4CDF 0101                288              MOVEM.L (A7)+,D0/A0
0000113A  4E75                     289              RTS
0000113C                           290  
0000113C                           291  ; -----------------------------------------------------------------------------
0000113C                           292  DMMFIRST
0000113C                           293  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
0000113C                           294  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000113C                           295  ; INPUT    - NONE
0000113C                           296  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000113C                           297  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000113C                           298  ; -----------------------------------------------------------------------------
0000113C  41F9 00001AC0            299              LEA     DMMDATA,A0
00001142  4A58                     300  DMMFRLOP    TST.W   (A0)+
00001144  6600 0016                301              BNE     DMMFRFND
00001148  D1FC 0000003E            302              ADD.L   #DMMBSIZE-2,A0
0000114E  B1FC 0000273F            303  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
00001154  6DEC                     304              BLT     DMMFRLOP
00001156  207C 00000000            305              MOVE.L  #0,A0
0000115C  4E75                     306  DMMFRFND    RTS
0000115E                           307  
0000115E                           308  ; -----------------------------------------------------------------------------
0000115E                           309  DMMNEXT
0000115E                           310  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
0000115E                           311  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000115E                           312  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
0000115E                           313  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000115E                           314  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000115E                           315  ; -----------------------------------------------------------------------------
0000115E  2F00                     316              MOVE.L  D0,-(A7)
00001160  2008                     317              MOVE.L  A0,D0
00001162  C0BC FFFFFFC0            318              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
00001168  0680 00000040            319              ADD.L   #DMMBSIZE,D0
0000116E  2040                     320              MOVE.L  D0,A0
00001170  201F                     321              MOVE.L  (A7)+,D0
00001172  60DA                     322              BRA     DMMFRCOM
00001174                           323  
00001174                           324  ; -----------------------------------------------------------------------------
00001174                           325  DMMFRSTO
00001174                           326  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00001174                           327  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001174                           328  ; INPUT    - D0.W : ID TO SEARCH
00001174                           329  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001174                           330  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001174                           331  ; -----------------------------------------------------------------------------
00001174  41F9 00001AC0            332              LEA     DMMDATA,A0
0000117A  B058                     333  DMMFLOOP    CMP.W   (A0)+,D0
0000117C  6700 0016                334              BEQ     DMMFFND
00001180  D1FC 0000003E            335              ADD.L   #DMMBSIZE-2,A0
00001186  B1FC 0000273F            336  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
0000118C  6DEC                     337              BLT     DMMFLOOP
0000118E  207C 00000000            338              MOVE.L  #0,A0
00001194  4E75                     339  DMMFFND     RTS
00001196                           340  
00001196                           341  ; -----------------------------------------------------------------------------
00001196                           342  DMMNEXTO
00001196                           343  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00001196                           344  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001196                           345  ; INPUT    - D0.W : ID TO SEARCH
00001196                           346  ;            A0   : POINTER WITHIN THE CURRENT SLOT
00001196                           347  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001196                           348  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001196                           349  ; -----------------------------------------------------------------------------
00001196  2F00                     350              MOVE.L  D0,-(A7)
00001198  2008                     351              MOVE.L  A0,D0
0000119A  C0BC FFFFFFC0            352              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011A0  0680 00000040            353              ADD.L   #DMMBSIZE,D0
000011A6  2040                     354              MOVE.L  D0,A0
000011A8  201F                     355              MOVE.L  (A7)+,D0
000011AA  60DA                     356              BRA     DMMFCOM
000011AC                           357  
000011AC                           358  ; -----------------------------------------------------------------------------
000011AC                           359  DMMALLOC
000011AC                           360  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
000011AC                           361  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
000011AC                           362  ; INPUT    - D0.W : ID TO ASSIGN
000011AC                           363  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
000011AC                           364  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011AC                           365  ; -----------------------------------------------------------------------------
000011AC  3F00                     366              MOVE.W  D0,-(A7)
000011AE  4240                     367              CLR.W   D0
000011B0  4EB8 1174                368              JSR     DMMFRSTO
000011B4  301F                     369              MOVE.W  (A7)+,D0
000011B6  B1FC 00000000            370              CMP.L   #0,A0
000011BC  6700 0006                371              BEQ     .END
000011C0  3140 FFFE                372              MOVE.W  D0,-2(A0)
000011C4  4E75                     373  .END        RTS
000011C6                           374  
000011C6                           375  ; -----------------------------------------------------------------------------
000011C6                           376  DMMFREE
000011C6                           377  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
000011C6                           378  ; SYSTEM (0)
000011C6                           379  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
000011C6                           380  ; OUTPUT   - NONE
000011C6                           381  ; MODIFIES - NONE
000011C6                           382  ; -----------------------------------------------------------------------------
000011C6  48E7 8080                383              MOVEM.L D0/A0,-(A7)
000011CA  2008                     384              MOVE.L  A0,D0
000011CC  C0BC FFFFFFC0            385              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011D2  2040                     386              MOVE.L  D0,A0
000011D4  4250                     387              CLR.W   (A0)
000011D6  4CDF 0101                388              MOVEM.L (A7)+,D0/A0
000011DA  4E75                     389              RTS
000011DC                           390  
000011DC                           391  
000011DC                           392  
000011DC                           393  
000011DC                           394  
000011DC                           395  
000011DC                           396  
000011DC                           397  
000011DC                           398  
000011DC                           399  
000011DC                           400  
000011DC                           401  
000011DC                           402  
000011DC                           403  
000011DC                           404  
000011DC                           405  
000011DC                           406  -------------------- end include --------------------
000011DC                           407              INCLUDE "GRAPHICS/GRAPHICS.X68" ; GRAPHICS CODE
000011DC                           408  ; =============================================================================
000011DC                           409  ; GRAPHICS
000011DC                           410  ; =============================================================================
000011DC                           411  
000011DC                           412  ; --- CODE INCLUDES -----------------------------------------------------------
000011DC                           413  
000011DC                           414              INCLUDE "GRAPHICS/MENU.X68"     ; FUNCTION TO DRAW MENU
000011DC                           415  ; =============================================================================
000011DC                           416  ; MENU
000011DC                           417  ; =============================================================================
000011DC                           418  
000011DC                           419  ; -----------------------------------------------------------------------------
000011DC                           420  DRAWMENU
000011DC                           421  ; OPERATIONS TO DRAW THE MENU
000011DC                           422  ; INPUT    - NONE
000011DC                           423  ; OUTPUT   - NONE
000011DC                           424  ; MODIFIES - NONE
000011DC                           425  ; -----------------------------------------------------------------------------
000011DC  48E7 6080                426              MOVEM.L D1-D2/A0,-(A7)
000011E0                           427              
000011E0  123C 007D                428              MOVE.B  #125,D1
000011E4  143C 0040                429              MOVE.B  #64,D2
000011E8  4EB9 000013A0            430              JSR     SETCURSOR
000011EE  41F9 0000121A            431              LEA     .TEXT1,A0
000011F4  4EB9 0000138C            432              JSR     DRAWTEXT
000011FA  123C 008C                433              MOVE.B  #140,D1
000011FE  143C 0040                434              MOVE.B  #64,D2 
00001202  4EB9 000013A0            435              JSR     SETCURSOR
00001208  41F9 00001221            436              LEA     .TEXT2,A0
0000120E  4EB9 0000138C            437              JSR     DRAWTEXT 
00001214                           438  
00001214  4CDF 0106                439              MOVEM.L (A7)+,D1-D2/A0       
00001218  4E75                     440              RTS
0000121A                           441              
0000121A= 54 45 54 52 49 53 00     442  .TEXT1      DC.B    'TETRIS',0
00001221= 50 52 45 53 53 20 ...    443  .TEXT2      DC.B    'PRESS "SPACE" TO START THE GAME',0
00001242                           444              DS.W    0
00001242                           445  -------------------- end include --------------------
00001242                           446              INCLUDE "GRAPHICS/GAME.X68"     ; FUNCTION TO DRAW GAME
00001242                           447  ; =============================================================================
00001242                           448  ; GAME
00001242                           449  ; =============================================================================
00001242                           450  
00001242                           451  ; -----------------------------------------------------------------------------
00001242                           452  DRAWGAME
00001242                           453  ; OPERATIONS TO DRAW THE GAME
00001242                           454  ; INPUT    - NONE
00001242                           455  ; OUTPUT   - NONE
00001242                           456  ; MODIFIES - NONE
00001242                           457  ; -----------------------------------------------------------------------------
00001242  48E7 F800                458              MOVEM.L D0-D4,-(A7)
00001246                           459              
00001246  223C 00FFFFFF            460              MOVE.L  #$00FFFFFF,D1
0000124C  4EB9 00001374            461              JSR     CHPENCL
00001252                           462              
00001252  323C 0159                463              MOVE.W  #XMATRIX-5,D1
00001256  343C 002D                464              MOVE.W  #YMATRIX-5,D2
0000125A  3601                     465              MOVE.W  D1,D3
0000125C  0643 0136                466              ADD.W   #MCOLUMN*SIDELENGTH+10,D3
00001260  3802                     467              MOVE.W  D2,D4
00001262  0644 0262                468              ADD.W   #(MROW-4)*SIDELENGTH+10,D4
00001266  103C 005A                469              MOVE.B  #90,D0
0000126A  4E4F                     470              TRAP    #15
0000126C  4EB9 000012E0            471              JSR DRAWMATRIX
00001272                           472              
00001272  4CDF 001F                473              MOVEM.L (A7)+,D0-D4
00001276  4E75                     474              RTS
00001278                           475  
00001278                           476  
00001278                           477  -------------------- end include --------------------
00001278                           478              INCLUDE "GRAPHICS/GAMEOVER.X68" ; FUNCTION TO DRAW GAME OVER PLOT
00001278                           479  ; =============================================================================
00001278                           480  ; GAMEOVER
00001278                           481  ; =============================================================================
00001278                           482  
00001278                           483  ; -----------------------------------------------------------------------------
00001278                           484  DRAWGAMEOVER
00001278                           485  ; OPERATIONS TO DRAW THE GAME OVER
00001278                           486  ; INPUT    - NONE
00001278                           487  ; OUTPUT   - NONE
00001278                           488  ; MODIFIES - NONE
00001278                           489  ; -----------------------------------------------------------------------------
00001278  48E7 6080                490              MOVEM.L D1-D2/A0,-(A7)
0000127C                           491              
0000127C  123C 007D                492              MOVE.B  #125,D1
00001280  143C 0040                493              MOVE.B  #64,D2
00001284  4EB9 000013A0            494              JSR     SETCURSOR
0000128A  41F9 000012B6            495              LEA     .TEXT1,A0
00001290  4EB9 0000138C            496              JSR     DRAWTEXT
00001296  123C 008C                497              MOVE.B  #140,D1
0000129A  143C 0040                498              MOVE.B  #64,D2 
0000129E  4EB9 000013A0            499              JSR     SETCURSOR
000012A4  41F9 000012C0            500              LEA     .TEXT2,A0
000012AA  4EB9 0000138C            501              JSR     DRAWTEXT 
000012B0                           502  
000012B0  4CDF 0106                503              MOVEM.L (A7)+,D1-D2/A0       
000012B4  4E75                     504              RTS
000012B6                           505              
000012B6= 47 41 4D 45 20 4F ...    506  .TEXT1      DC.B    'GAME OVER',0
000012C0= 50 52 45 53 53 20 ...    507  .TEXT2      DC.B    'PRESS "SPACE" TO START THE GAME',0  
000012E0                           508  
000012E0                           509  
000012E0                           510  
000012E0                           511  -------------------- end include --------------------
000012E0                           512  
000012E0                           513  ; -----------------------------------------------------------------------------
000012E0                           514  DRAWMATRIX
000012E0                           515  ; PRINTS THE MATRIX IN THE INDICATED SPACE
000012E0                           516  ; INPUT    - NONE
000012E0                           517  ; OUTPUT   - NONE
000012E0                           518  ; MODIFIES - NONE
000012E0                           519  ; -----------------------------------------------------------------------------
000012E0                           520              
000012E0  48E7 F0C0                521              MOVEM.L D0-D3/A0-A1,-(A7)           
000012E4                           522              
000012E4  41F9 00002788            523              LEA.L   ROW0,A0
000012EA  43F9 00002852            524              LEA.L   COLOR,A1
000012F0  4280                     525              CLR.L   D0                      ; D0 = CELL TO DRAW
000012F2  4282                     526              CLR.L   D2                      ; D2 = Y
000012F4  4283                     527              CLR.L   D3                      ; D3 = X
000012F6                           528              
000012F6  4281                     529  .LOOP       CLR.L   D1
000012F8  1230 0000                530              MOVE.B  (A0,D0),D1              ; D1 = CELL CONTENT
000012FC                           531              
000012FC  0801 0000                532              BTST.L  #0,D1                   ; CHECKS IF THE CELL IS BEEING USED
00001300  6700 0024                533              BEQ     .SKIP1                  ; IF NOT SKIPS.
00001304                           534              
00001304  E809                     535              LSR.B   #4,D1                   ; D1 = COLOR INDEX
00001306  C2FC 0004                536              MULU.W  #4,D1
0000130A  2231 1000                537              MOVE.L  (A1,D1),D1              ; D1 = COLOR
0000130E  4EB9 00001374            538              JSR     CHPENCL                 ; CHANGES THE COLOR TO THE PEN
00001314  4EB9 00001380            539              JSR     CHFILLCL                ; CHANGES THE COLOR TO THE FILL
0000131A                           540              
0000131A  2202                     541              MOVE.L  D2,D1                   ; D1 = LX.B,UY.B
0000131C  4841                     542              SWAP.W  D1
0000131E  D243                     543              ADD.W   D3,D1
00001320                           544              
00001320  4EB9 00001342            545              JSR     DRAWCELL
00001326                           546              
00001326  5202                     547  .SKIP1      ADDQ.B  #1,D2                   ; ADDS 1 TO X
00001328  B47C 000A                548              CMP     #MCOLUMN,D2             ; CHECKS IF END OF ROW
0000132C  6600 0006                549              BNE     .SKIP2
00001330                           550              
00001330  5203                     551              ADDQ.B  #1,D3                   ; ADDS 1 TO Y
00001332  4202                     552              CLR.B   D2                      ; CLEAR X
00001334                           553              
00001334  5240                     554  .SKIP2      ADDQ.W  #1,D0                   ; ADDS 1 TO CELL TO DRAW
00001336  B07C 00C8                555              CMP     #(MROW-4)*MCOLUMN,D0    ; CHECKS IF END OF MATRIX
0000133A  66BA                     556              BNE     .LOOP
0000133C                           557        
0000133C  4CDF 030F                558              MOVEM.L (A7)+,D0-D3/A0-A1
00001340                           559        
00001340  4E75                     560              RTS
00001342                           561              
00001342                           562  ; -----------------------------------------------------------------------------
00001342                           563  DRAWCELL
00001342                           564  ; DRAW A SQUARE IN THE SCREEN
00001342                           565  ; INPUT    - D1.L   X AND Y OF THE CELL
00001342                           566  ; OUTPUT   - NONE
00001342                           567  ; MODIFIES - NONE
00001342                           568  ; -----------------------------------------------------------------------------
00001342                           569              
00001342  48E7 F800                570              MOVEM.L D0-D4,-(A7)
00001346                           571              
00001346  3401                     572              MOVE.W  D1,D2                   ; D2 = Y
00001348  4241                     573              CLR.W   D1
0000134A  4841                     574              SWAP.W  D1                      ; D1 = X
0000134C                           575              
0000134C  C2FC 001E                576              MULU.W  #SIDELENGTH,D1          ; D1 = SQUARE LX INSIDE MATRIX
00001350  C4FC 001E                577              MULU.W  #SIDELENGTH,D2          ; D2 = SQUARE UY INSIDE MATRIX
00001354                           578              
00001354  0641 015E                579              ADD.W   #XMATRIX,D1             ; D1 = LX
00001358  0642 0032                580              ADD.W   #YMATRIX,D2             ; D2 = UY
0000135C                           581              
0000135C  3601                     582              MOVE.W  D1,D3
0000135E  0643 001E                583              ADD.W   #SIDELENGTH,D3          ; D3 = RX
00001362  3802                     584              MOVE.W  D2,D4
00001364  0644 001E                585              ADD.W   #SIDELENGTH,D4          ; D4 = LY
00001368                           586              
00001368  103C 0057                587              MOVE.B  #87,D0
0000136C  4E4F                     588              TRAP    #15                     ; DRAW SQUARE
0000136E                           589              
0000136E  4CDF 001F                590              MOVEM.L (A7)+,D0-D4
00001372                           591  
00001372  4E75                     592              RTS
00001374                           593  
00001374                           594  ; -----------------------------------------------------------------------------
00001374                           595  CHPENCL
00001374                           596  ; CHANGES THE COLOR TO THE PEN
00001374                           597  ; INPUT    - D1.L   COLOR $00BBGGRR
00001374                           598  ; OUTPUT   - NONE
00001374                           599  ; MODIFIES - NONE
00001374                           600  ; -----------------------------------------------------------------------------
00001374                           601              
00001374  2F00                     602              MOVE.L  D0,-(A7)
00001376  103C 0050                603              MOVE.B  #80,D0
0000137A  4E4F                     604              TRAP    #15
0000137C  201F                     605              MOVE.L  (A7)+,D0
0000137E  4E75                     606              RTS
00001380                           607              
00001380                           608  ; -----------------------------------------------------------------------------
00001380                           609  CHFILLCL
00001380                           610  ; CHANGES THE COLOR TO THE FILL
00001380                           611  ; INPUT    - D1.L   COLOR $00BBGGRR
00001380                           612  ; OUTPUT   - NONE
00001380                           613  ; MODIFIES - NONE
00001380                           614  ; -----------------------------------------------------------------------------
00001380                           615              
00001380  2F00                     616              MOVE.L  D0,-(A7)
00001382  103C 0051                617              MOVE.B  #81,D0
00001386  4E4F                     618              TRAP    #15
00001388  201F                     619              MOVE.L  (A7)+,D0
0000138A  4E75                     620              RTS
0000138C                           621              
0000138C                           622  ; -----------------------------------------------------------------------------
0000138C                           623  DRAWTEXT
0000138C                           624  ; ALLOWS TO DRAW TEXT IN WHITE IN THE SCREEN WHERE THE POINTER IS
0000138C                           625  ; INPUT    - A0.L POINTER TO THE STRING 
0000138C                           626  ; OUTPUT   - NONE
0000138C                           627  ; MODIFIES - SCREEN
0000138C                           628  ; -----------------------------------------------------------------------------
0000138C                           629              
0000138C  48E7 C000                630              MOVEM.L D0-D1,-(A7)
00001390  103C 0006                631              MOVE.B  #6,D0
00001394  1218                     632  .LOOP:      MOVE.B  (A0)+,D1
00001396  4E4F                     633              TRAP    #15
00001398  66FA                     634              BNE     .LOOP 
0000139A  4CDF 0003                635              MOVEM.L (A7)+,D0-D1
0000139E  4E75                     636              RTS
000013A0                           637              
000013A0                           638  ; -----------------------------------------------------------------------------
000013A0                           639  SETCURSOR
000013A0                           640  ; MOVES THE POINTER IN A CONCTRETE POSITION IN THE SCREEN
000013A0                           641  ; INPUT    - D1.B = COL NUMBER D2.B = ROW NUMBER 
000013A0                           642  ; OUTPUT   - NONE
000013A0                           643  ; MODIFIES - SCREEN
000013A0                           644  ; -----------------------------------------------------------------------------
000013A0                           645              
000013A0  48E7 C000                646              MOVEM.L D0-D1,-(A7)
000013A4  E889                     647              LSR.L   #4,D1
000013A6  D242                     648              ADD.W   D2,D1
000013A8  103C 000B                649              MOVE.B  #11,D0
000013AC  4E4F                     650              TRAP    #15
000013AE  4CDF 0003                651              MOVEM.L (A7)+,D0-D1
000013B2  4E75                     652              RTS
000013B4                           653              
000013B4                           654  ; -----------------------------------------------------------------------------
000013B4                           655  GETCURSOR
000013B4                           656  ; OBTEINS THE POINTER
000013B4                           657  ; INPUT    - NONE
000013B4                           658  ; OUTPUT   - D1 = HIGH BYTE IS COL, LOW BYTE IS ROW 
000013B4                           659  ; MODIFIES - SCREEN
000013B4                           660  ; -----------------------------------------------------------------------------
000013B4                           661              
000013B4  48E7 8000                662              MOVEM.L D0,-(A7)
000013B8  323C 00FF                663              MOVE.W  #$00FF,D1
000013BC  103C 000B                664              MOVE.B  #11,D0
000013C0  4E4F                     665              TRAP    #15
000013C2  4CDF 0001                666              MOVEM.L (A7)+,D0
000013C6  4E75                     667              RTS
000013C8                           668  
000013C8                           669  
000013C8                           670  
000013C8                           671  
000013C8                           672  
000013C8                           673  
000013C8                           674  
000013C8                           675  -------------------- end include --------------------
000013C8                           676              INCLUDE "GAME/GAME.X68"         ; GAME CODE
000013C8                           677  ; =============================================================================
000013C8                           678  ; STATUS
000013C8                           679  ; =============================================================================
000013C8                           680  
000013C8                           681  ; --- CODE INCLUDES -----------------------------------------------------------
000013C8                           682  
000013C8                           683              INCLUDE "GAME/CONST.X68"        ; CONSTANTS
000013C8                           684  ; =============================================================================
000013C8                           685  ; GAME CONST
000013C8                           686  ; =============================================================================
000013C8                           687  
000013C8                           688  ; --- GAME RELATED CONSTANTS ------------------------------------------------
000013C8                           689  
000013C8  =00000002                690  ISRDOWN     EQU     2
000013C8                           691  
000013C8                           692  
000013C8                           693  ; --- MATRIX RELATED CONSTANTS ------------------------------------------------
000013C8                           694  
000013C8  =00000018                695  MROW        EQU     24                      ; NOT CHANGES THE NUMBER OF ROWS
000013C8  =0000000A                696  MCOLUMN     EQU     10    
000013C8  =00000001                697  ISFILLED    EQU     %00000001               ; MASK FOR CHECK A SQUARE IS USED
000013C8  =000000F0                698  WHATCOLOR   EQU     %11110000               ; MASK TO GET THE COLOR OF A SQUARE
000013C8                           699  
000013C8                           700  ; --- GRAFICS RELATED CONSTANTS -----------------------------------------------
000013C8                           701  
000013C8  =0000001E                702  SIDELENGTH  EQU     30                       ; SIZE IN PIXEL OF A SQUARE
000013C8  =0000015E                703  XMATRIX     EQU     (SCRWIDTH/2)-(SIDELENGTH*MCOLUMN)/2
000013C8  =00000032                704  YMATRIX     EQU     (SCRHEIGH/2)-(SIDELENGTH*(MROW-4))/2                      
000013C8                           705  
000013C8                           706  
000013C8                           707  
000013C8                           708  
000013C8                           709  -------------------- end include --------------------
000013C8                           710              INCLUDE "GAME/INIT.X68"         ; GAME INIT
000013C8                           711  ; =============================================================================
000013C8                           712  ; GAME
000013C8                           713  ; =============================================================================
000013C8                           714  
000013C8                           715  ; -----------------------------------------------------------------------------
000013C8                           716  INITMATRIX
000013C8                           717  ; CLEAR MATRIX
000013C8                           718  ; INPUT    - NONE
000013C8                           719  ; OUTPUT   - NONE
000013C8                           720  ; MODIFIES - MATRIS
000013C8                           721  ; -----------------------------------------------------------------------------
000013C8                           722              
000013C8  48E7 8080                723              MOVEM.L D0/A0,-(A7)
000013CC  41F9 00002760            724              LEA.L   HROW4,A0
000013D2  203C 000000EF            725              MOVE.L  #MROW*MCOLUMN-1,D0        ; COUNTER OF CELLS TO CLEAN
000013D8  4230 0000                726  .LOOP       CLR.B   (A0,D0)
000013DC  51C8 FFFA                727              DBRA    D0,.LOOP
000013E0  4CDF 0101                728              MOVEM.L (A7)+,D0/A0
000013E4  4E75                     729              RTS
000013E6                           730  
000013E6                           731  ; -----------------------------------------------------------------------------
000013E6                           732  ISRMOVEDOWN
000013E6                           733  ; CLEAR MATRIX
000013E6                           734  ; INPUT    - NONE
000013E6                           735  ; OUTPUT   - NONE
000013E6                           736  ; MODIFIES - MATRIS
000013E6                           737  ; -----------------------------------------------------------------------------
000013E6                           738              
000013E6  4EB9 00001A4E            739              JSR     DOWNFIGURE
000013EC  4E73                     740              RTE
000013EE                           741  
000013EE                           742  
000013EE                           743  
000013EE                           744  -------------------- end include --------------------
000013EE                           745              INCLUDE "GAME/STATES.X68"       ; GAME STATES
000013EE                           746  ; =============================================================================
000013EE                           747  ; STATES
000013EE                           748  ; =============================================================================
000013EE                           749  
000013EE                           750  ; ----------------------------------------------------------------------------
000013EE                           751  STAINIT
000013EE                           752  ; INITALIZES STATE MANAGER
000013EE                           753  ; INPUT    - NONE
000013EE                           754  ; OUTPUT   - NONE
000013EE                           755  ; MODIFIES - NONE
000013EE                           756  ; -----------------------------------------------------------------------------
000013EE                           757              
000013EE  41F9 00002742            758              LEA.L   STATES,A0               ; A0 = STATES LIST
000013F4  23E8 0004 00002756       759              MOVE.L  1*4(A0),STATE          ; STATE = STANMME
000013FC  4E75                     760              RTS
000013FE                           761              
000013FE                           762  ; -----------------------------------------------------------------------------
000013FE                           763  STANMME
000013FE                           764  ; OPERATIONS WHEN IS THE MAIN MENU
000013FE                           765  ; INPUT    - NONE
000013FE                           766  ; OUTPUT   - NONE
000013FE                           767  ; MODIFIES - NONE
000013FE                           768  ; -----------------------------------------------------------------------------
000013FE                           769              
000013FE  4EB8 11DC                770              JSR     DRAWMENU                ; DRAWS THE MENU PLOT
00001402                           771              
00001402  0839 0004 00001A9D       772              BTST.B  #4,KBDEDGE              ; IF "SPACE" IS PRESED
0000140A  6700 0010                773              BEQ     .END
0000140E  41F9 00002742            774              LEA.L   STATES,A0               ; A0 = STATES LIST
00001414  23E8 0008 00002756       775              MOVE.L  2*4(A0),STATE           ; UPDATES NEXT STATE    
0000141C  4E75                     776  .END        RTS
0000141E                           777  
0000141E                           778  ; -----------------------------------------------------------------------------
0000141E                           779  STANWGM
0000141E                           780  ; OPERATIONS WHEN THE GAME STARTS
0000141E                           781  ; INPUT    - NONE
0000141E                           782  ; OUTPUT   - NONE
0000141E                           783  ; MODIFIES - NONE
0000141E                           784  ; -----------------------------------------------------------------------------
0000141E                           785              
0000141E  48E7 F000                786              MOVEM.L D0-D3,-(A7)
00001422  4EB8 13C8                787              JSR     INITMATRIX              ; CLEAR THE MATRIX
00001426  4239 0000275B            788              CLR.B   FIGROTA                 ; DEFAULT ROTATION
0000142C  4239 0000275C            789              CLR.B   FIGPOSI                 ; DEFAULT POSITION
00001432  4239 00002740            790              CLR.B   GAMEOVER                ; DEFAULT GAMEOVER STATUS
00001438                           791              
00001438  41F9 00002742            792              LEA.L   STATES,A0               ; A0 = STATES LIST
0000143E  23E8 000C 00002756       793              MOVE.L  3*4(A0),STATE          ; STATE = STAUPDA
00001446                           794              
00001446  4EB9 000019A4            795              JSR     INITFIGURE
0000144C                           796  
0000144C  4CDF 000F                797              MOVEM.L (A7)+,D0-D3
00001450  4E75                     798              RTS
00001452                           799  
00001452                           800  ; -----------------------------------------------------------------------------
00001452                           801  STAUPDA
00001452                           802  ; OPERATIONS FOR THE GAME WHEN IT IS RUNNING
00001452                           803  ; INPUT    - KBDVAL, KBDEDGE
00001452                           804  ; OUTPUT   - NONE
00001452                           805  ; MODIFIES - MATRIX
00001452                           806  ; -----------------------------------------------------------------------------
00001452                           807              
00001452  4EB8 1242                808              JSR     DRAWGAME                ; DRAWS THE GAME PLOT
00001456                           809              
00001456  2F00                     810              MOVE.L  D0,-(A7)
00001458                           811              
00001458                           812              ; CHECKS IF THE FIGURE CAN BE MOVED DOWNWARDS IF TRUE THEN KEYS
00001458  0839 0000 0000275D       813              BTST.B  #0,FIGLDOW                        
00001460  6700 0020                814              BEQ     .LEFT
00001464                           815         
00001464                           816              ; CHECK IF IT IS GAME OVER
00001464  4EB9 0000151A            817              JSR     ISGAMEOVER
0000146A  0839 0000 00002740       818              BTST.B  #0,GAMEOVER
00001472  6600 008A                819              BNE     .GAMEOVER
00001476                           820              
00001476                           821              ; CHECK IF IT IS TETRIS AND CLEARS IT
00001476  4EB9 00001546            822              JSR     ISTETRIS
0000147C                           823              
0000147C                           824              ; CREATES A NEW FIGURE
0000147C  4EB9 000019A4            825              JSR     INITFIGURE
00001482                           826              
00001482                           827              ; ACTIONS IF ANY KEY IS PRESED (LEFT, RIGHT, DOWN, UP, SPACE)
00001482  0839 0000 00001A9D       828  .LEFT       BTST.B  #0,KBDEDGE
0000148A  6700 0008                829              BEQ     .RIGHT
0000148E  4EB9 000019DC            830              JSR     LEFTFIGURE
00001494                           831              
00001494  0839 0002 00001A9D       832  .RIGHT      BTST.B  #2,KBDEDGE
0000149C  6700 0008                833              BEQ     .DOWN
000014A0  4EB9 00001A02            834              JSR     RIGHTFIGURE
000014A6                           835  
000014A6  0839 0003 00001A9C       836  .DOWN       BTST.B  #3,KBDVAL
000014AE  6700 0008                837              BEQ     .UP
000014B2  4EB9 00001A4E            838              JSR     DOWNFIGURE
000014B8                           839  
000014B8  0839 0001 00001A9C       840  .UP         BTST.B  #1,KBDVAL
000014C0  6700 0008                841              BEQ     .SPACE
000014C4  4EB9 00001A28            842              JSR     ROTATEFIGURE           
000014CA                           843              
000014CA                           844              
000014CA  0839 0004 00001A9D       845  .SPACE      BTST.B #4,KBDEDGE
000014D2  6700 0012                846              BEQ     .TEMPMOVE
000014D6  4EB9 00001A4E            847              JSR     DOWNFIGURE
000014DC  0839 0000 0000275D       848              BTST.B  #0,FIGLDOW                        
000014E4  67E4                     849              BEQ     .SPACE
000014E6                           850              
000014E6                           851              ; MOVE FIGURE DOWN EACH 50 SEC APROX
000014E6                           852              
000014E6  1039 00001A9F            853  .TEMPMOVE   MOVE.B  SCRCYCCT,D0
000014EC  0200 001F                854              ANDI.B  #%00011111,D0
000014F0  6600 001E                855              BNE     .END
000014F4  4EB9 00001A4E            856              JSR     DOWNFIGURE
000014FA  6000 0014                857              BRA     .END
000014FE                           858  
000014FE                           859              ; IF IS A GAME OVER CHANGE STATE
000014FE                           860              
000014FE  2F08                     861  .GAMEOVER   MOVE.L  A0,-(A7)
00001500  41F9 00002742            862              LEA.L   STATES,A0
00001506  23E8 0010 00002756       863              MOVE.L  4*4(A0),STATE
0000150E  205F                     864              MOVE.L  (A7)+,A0
00001510                           865  
00001510  201F                     866  .END        MOVE.L  (A7)+,D0
00001512  4E75                     867              RTS
00001514                           868              
00001514                           869  ; -----------------------------------------------------------------------------
00001514                           870  STAGMOV
00001514                           871  ; OPERATIONS WHEN THE GAME REACHES A GAME OVER STATE
00001514                           872  ; INPUT    - NONE
00001514                           873  ; OUTPUT   - NONE
00001514                           874  ; MODIFIES - NONE
00001514                           875  ; -----------------------------------------------------------------------------
00001514                           876              
00001514  4EB8 1278                877              JSR     DRAWGAMEOVER            ; DRAWS THE GAME OVER PLOT
00001518                           878              
00001518  4E75                     879              RTS
0000151A                           880  
0000151A                           881  
0000151A                           882  
0000151A                           883  
0000151A                           884  
0000151A                           885  
0000151A                           886  
0000151A                           887  
0000151A                           888  -------------------- end include --------------------
0000151A                           889  
0000151A                           890  ; -----------------------------------------------------------------------------
0000151A                           891  ISGAMEOVER
0000151A                           892  ; CHECKS IF THERE IS A GAME OVER
0000151A                           893  ; INPUT    - NONE
0000151A                           894  ; OUTPUT   - NONE
0000151A                           895  ; MODIFIES - NONE
0000151A                           896  ; -----------------------------------------------------------------------------
0000151A                           897              
0000151A  48E7 8080                898              MOVEM.L D0/A0,-(A7)         
0000151E                           899              
0000151E  41F9 0000277E            900              LEA.L   HROW1,A0
00001524  7009                     901              MOVE.L  #MCOLUMN-1,D0
00001526                           902              
00001526  0830 0000 0000           903  .LOOP       BTST.B  #0,(A0,D0)           
0000152C  6600 000A                904              BNE     .SKIP
00001530  51C8 FFF4                905              DBRA    D0,.LOOP 
00001534  6000 000A                906              BRA     .END
00001538                           907              
00001538  13FC 0001 00002740       908  .SKIP       MOVE.B  #1,GAMEOVER     
00001540                           909              
00001540  4CDF 0101                910  .END        MOVEM.L (A7)+,D0/A0
00001544  4E75                     911              RTS
00001546                           912  
00001546                           913  ; -----------------------------------------------------------------------------
00001546                           914  ISTETRIS
00001546                           915  ; CHECKS IF THERE IS A TETRIS
00001546                           916  ; INPUT    - NONE
00001546                           917  ; OUTPUT   - NONE
00001546                           918  ; MODIFIES - NONE
00001546                           919  ; -----------------------------------------------------------------------------
00001546                           920              
00001546  48E7 F880                921              MOVEM.L D0-D4/A0,-(A7)         
0000154A                           922              
0000154A  41F9 00002788            923              LEA.L   ROW0,A0                 ; A0 = MATRIX BEGIN
00001550  4280                     924              CLR.L   D0                      ; D0 = CELL POINTER
00001552  4281                     925              CLR.L   D1                      ; D1 = COLUMN COUNTER
00001554  4283                     926              CLR.L   D3                      ; D3 = FULL ROWS AFTER D2 POINTER
00001556  4284                     927              CLR.L   D4
00001558  6000 000E                928              BRA     .START
0000155C                           929              
0000155C                           930              ; LOOP TO FIND A FULL LINE
0000155C                           931   
0000155C  5201                     932  .NEXT1      ADDQ.B  #1,D1
0000155E  D001                     933              ADD.B   D1,D0                      
00001560  B07C 00C8                934              CMP     #(MROW-4)*MCOLUMN,D0
00001564  6700 0074                935              BEQ     .EXIT
00001568  7209                     936  .START      MOVE.L  #MCOLUMN-1,D1                        
0000156A                           937              
0000156A                           938              ; CHECKS THE ROW IF IS FULL
0000156A                           939              
0000156A  0830 0000 0000           940  .LOOP1      BTST.B  #0,(A0,D0)
00001570  67EA                     941              BEQ     .NEXT1
00001572  5200                     942              ADDQ.B  #1,D0
00001574  51C9 FFF4                943              DBRA    D1,.LOOP1
00001578                           944              
00001578                           945              ; IF A ROW IS FULL THEN
00001578                           946              
00001578  1800                     947              MOVE.B  D0,D4                   
0000157A  0404 000A                948              SUB.B   #MCOLUMN,D4             ; STARTING CELL IN FIRST FULL LINE
0000157E                           949              
0000157E                           950              ; CLEAN THE FULL ROW
0000157E                           951              
0000157E  323C 0009                952  .CLEAN      MOVE.W  #MCOLUMN-1,D1
00001582  5300                     953  .LOOP2      SUBQ.B  #1,D0
00001584  4230 0000                954              CLR.B   (A0,D0)
00001588  51C9 FFF8                955              DBRA    D1,.LOOP2
0000158C  0600 000A                956              ADD.B   #MCOLUMN,D0          
00001590                           957              
00001590                           958              ; UPDATE FULL ROW COUNTER
00001590                           959              
00001590  5203                     960              ADDQ.B  #1,D3
00001592  B67C 0004                961              CMP     #4,D3
00001596  6700 0028                962              BEQ     .MOVE
0000159A  B07C 00C8                963              CMP     #(MROW-4)*MCOLUMN,D0
0000159E  6700 0020                964              BEQ     .MOVE
000015A2                           965              
000015A2                           966              ; CHECK NEXT LINE IF IS FULL
000015A2                           967              
000015A2  323C 0009                968              MOVE.W  #MCOLUMN-1,D1
000015A6  0830 0000 0000           969  .LOOP3      BTST.B  #0,(A0,D0)
000015AC  6700 000A                970              BEQ     .PREMOVE
000015B0  5200                     971              ADDQ.B  #1,D0
000015B2  51C9 FFF2                972              DBRA    D1,.LOOP3
000015B6  60C6                     973              BRA     .CLEAN  
000015B8                           974  
000015B8                           975              ; MOVE MATRIX CONTENT DOWN
000015B8                           976  
000015B8  5201                     977  .PREMOVE    ADDQ.B  #1,D1
000015BA  D001                     978              ADD.B   D1,D0
000015BC  0400 000A                979              SUB.B   #MCOLUMN,D0
000015C0                           980              
000015C0  41F9 00002760            981  .MOVE       LEA.L   HROW4,A0
000015C6  0604 0027                982              ADD.B   #MCOLUMN*4-1,D4
000015CA  0600 0027                983              ADD.B   #MCOLUMN*4-1,D0
000015CE                           984  
000015CE  11B0 4000 0000           985  .LOOP4      MOVE.B  (A0,D4),(A0,D0)
000015D4  5300                     986              SUBQ.B  #1,D0
000015D6  51CC FFF6                987              DBRA    D4,.LOOP4                      
000015DA                           988                         
000015DA  4CDF 011F                989  .EXIT       MOVEM.L (A7)+,D0-D4/A0
000015DE  4E75                     990              RTS
000015E0                           991  
000015E0                           992  
000015E0                           993  
000015E0                           994  
000015E0                           995  
000015E0                           996  
000015E0                           997  
000015E0                           998  
000015E0                           999  
000015E0                          1000  
000015E0                          1001  
000015E0                          1002  
000015E0                          1003  
000015E0                          1004  
000015E0                          1005  
000015E0                          1006  
000015E0                          1007  
000015E0                          1008  
000015E0                          1009  -------------------- end include --------------------
000015E0                          1010              INCLUDE "FIGURES/FIGURE.X68"    ; FIGURE CODE
000015E0                          1011  ; =============================================================================
000015E0                          1012  ; FIGURE
000015E0                          1013  ; =============================================================================
000015E0                          1014  
000015E0                          1015  ; --- CODE INCLUDES -----------------------------------------------------------
000015E0                          1016  
000015E0                          1017              INCLUDE "FIGURES/O.X68"   ; TETROMINO O
000015E0                          1018  ; =============================================================================
000015E0                          1019  ; TETROMINO O
000015E0                          1020  ; =============================================================================
000015E0                          1021  
000015E0                          1022  ; -----------------------------------------------------------------------------
000015E0                          1023  INITO
000015E0                          1024  ; ADDS A NEW SQUARE IN THE HIDEN ZONE OF THE MATRIX
000015E0                          1025  ; INPUT    - NONE
000015E0                          1026  ; OUTPUT   - NONE
000015E0                          1027  ; MODIFIES - MATRIX
000015E0                          1028  ; -----------------------------------------------------------------------------
000015E0                          1029              
000015E0  48E7 8080               1030              MOVEM.L D0/A0,-(A7)
000015E4  41F9 00002760           1031              LEA.L   HROW4,A0
000015EA  4280                    1032              CLR.L   D0
000015EC                          1033              
000015EC  103C 0018               1034              MOVE.B  #4+MCOLUMN*2,D0
000015F0  13C0 0000275C           1035              MOVE.B  D0,FIGPOSI
000015F6                          1036              
000015F6  11BC 0031 0000          1037              MOVE.B  #$31,(A0,D0)
000015FC  5280                    1038              ADDQ.L  #1,D0
000015FE  11BC 0031 0000          1039              MOVE.B  #$31,(A0,D0)
00001604  0600 000A               1040              ADD.B   #MCOLUMN,D0
00001608  11BC 0031 0000          1041              MOVE.B  #$31,(A0,D0)
0000160E  5380                    1042              SUBQ.L  #1,D0
00001610  11BC 0031 0000          1043              MOVE.B  #$31,(A0,D0)
00001616                          1044              
00001616  4CDF 0101               1045              MOVEM.L (A7)+,D0/A0
0000161A  4E75                    1046              RTS
0000161C                          1047  
0000161C                          1048  ; -----------------------------------------------------------------------------
0000161C                          1049  DOWNO
0000161C                          1050  ; MOVES THE CURRENT SQUATE IN THE MATRIX
0000161C                          1051  ; INPUT    - NONE
0000161C                          1052  ; OUTPUT   - NONE
0000161C                          1053  ; MODIFIES - MATRIX
0000161C                          1054  ; -----------------------------------------------------------------------------
0000161C                          1055              
0000161C  48E7 E080               1056              MOVEM.L D0-D2/A0,-(A7)
00001620                          1057              
00001620  4280                    1058              CLR.L   D0
00001622                          1059              
00001622  41F9 00002760           1060              LEA.L   HROW4,A0                ; A0 = BEGIN OF MATRIX
00001628  1039 0000275C           1061              MOVE.B  FIGPOSI,D0              ; D0 = START OF FIGURE
0000162E                          1062              
0000162E                          1063              ; CHECK IF IT CAN GO DOWN MORE
0000162E                          1064              
0000162E  0600 0014               1065              ADD.B   #MCOLUMN*2,D0           ; BOTTOM ROW AFTER THE SQUARE
00001632  B07C 00F0               1066              CMP     #MCOLUMN*MROW,D0        ; CHECK IF IS END OF MATRIX 
00001636  6400 0050               1067              BHS     .NEXT                   ; IF IT IS THEN GO TO NEXT
0000163A                          1068              
0000163A  323C 0001               1069              MOVE.W  #1,D1                   ; CREATE A COUNTER FOR LOOP
0000163E                          1070              
0000163E  1430 0000               1071  .LOOP       MOVE.B  (A0,D0),D2              ; MOVE CELL TO D2
00001642  0802 0000               1072              BTST.L  #0,D2                   ; CHECKS IF D2 IS FILLED
00001646  6700 0006               1073              BEQ     .SKIP                   ; IF NOT SKIP
0000164A  6000 003C               1074              BRA     .NEXT                   ; IF TRUE THEN NEXT
0000164E  5200                    1075  .SKIP       ADDQ.B  #1,D0                   ; NEXT CELL TO CHECK
00001650  51C9 FFEC               1076              DBRA    D1,.LOOP                ; LOOP                   
00001654                          1077              
00001654                          1078              ; MOVES THE FIGURE DOWN BY ONE ROW
00001654                          1079              
00001654  4281                    1080              CLR.L   D1
00001656  1039 0000275C           1081              MOVE.B  FIGPOSI,D0              ; D0 = START OF FIGURE
0000165C  1200                    1082              MOVE.B  D0,D1                   
0000165E  0601 0014               1083              ADD.B   #MCOLUMN*2,D1           ; D1 = CELL BELOW FIGURE
00001662                          1084              
00001662  11B0 0000 1000          1085              MOVE.B  (A0,D0),(A0,D1)         ; MOVE CONTENT BETWEEN CELLS
00001668  4230 0000               1086              CLR.B   (A0,D0)                 ; CLEARS TOP CELL
0000166C  5200                    1087              ADDQ.B  #1,D0                   ; DO = SECOND CELL
0000166E  5201                    1088              ADDQ.B  #1,D1                   ; D1 = FOURTH CELL
00001670  11B0 0000 1000          1089              MOVE.B  (A0,D0),(A0,D1)
00001676  4230 0000               1090              CLR.B   (A0,D0)
0000167A                          1091              
0000167A  0600 0009               1092              ADD.B   #MCOLUMN-1,D0           ; D0 = NEW FIGURE POINTER
0000167E  13C0 0000275C           1093              MOVE.B  D0,FIGPOSI              ; SAVES NEW FIGURE POINTER
00001684  6000 000A               1094              BRA     .END
00001688                          1095              
00001688  13FC 0001 0000275D      1096  .NEXT       MOVE.B  #1,FIGLDOW              ; CHANGES FIGLDOW TO YES (1)
00001690  4CDF 0107               1097  .END        MOVEM.L (A7)+,D0-D2/A0
00001694  4E75                    1098              RTS
00001696                          1099  
00001696                          1100  ; -----------------------------------------------------------------------------
00001696                          1101  LEFTO
00001696                          1102  ; CHECKS IF CAN GO FUTHER DOWN
00001696                          1103  ; INPUT    - NONE
00001696                          1104  ; OUTPUT   - NONE
00001696                          1105  ; MODIFIES - NONE
00001696                          1106  ; -----------------------------------------------------------------------------
00001696                          1107              
00001696  48E7 C080               1108              MOVEM.L D0-D1/A0,-(A7)
0000169A                          1109              
0000169A  4280                    1110              CLR.L   D0
0000169C  4281                    1111              CLR.L   D1
0000169E                          1112              
0000169E  41F9 00002760           1113              LEA.L   HROW4,A0                ; A0 = START OF MATRIX
000016A4  1039 0000275C           1114              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
000016AA                          1115              
000016AA                          1116              ; CHECK IF THERE IS END OF MATRIX TO THE LEFT
000016AA                          1117              
000016AA  3200                    1118              MOVE.W  D0,D1
000016AC  0641 000A               1119              ADD.W   #MCOLUMN,D1
000016B0  80FC 000A               1120              DIVU.W  #MCOLUMN,D0
000016B4  4840                    1121              SWAP.W  D0
000016B6  4A40                    1122              TST.W   D0
000016B8  6600 0006               1123              BNE     .SKIP1
000016BC  6000 0066               1124              BRA     .END
000016C0  82FC 000A               1125  .SKIP1      DIVU.W  #MCOLUMN,D1
000016C4  4841                    1126              SWAP.W  D1
000016C6  4A41                    1127              TST.W   D1
000016C8  6700 005A               1128              BEQ     .END
000016CC                          1129              
000016CC                          1130              ; CHECK IF THERE IS A FULL CELL TO THE LEFT
000016CC                          1131              
000016CC  4281                    1132              CLR.L   D1
000016CE  4280                    1133              CLR.L   D0
000016D0  1039 0000275C           1134              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
000016D6                          1135              
000016D6  5300                    1136              SUBQ.B  #1,D0
000016D8  0830 0000 0000          1137              BTST.B  #0,(A0,D0)
000016DE  6600 0044               1138              BNE     .END
000016E2  0600 000A               1139              ADD.B   #MCOLUMN,D0
000016E6  0830 0000 0000          1140              BTST.B  #0,(A0,D0)
000016EC  6600 0036               1141              BNE     .END
000016F0                          1142              
000016F0                          1143              ; MOVES FIGURE TO THE LEFT BY ONE CELL
000016F0                          1144              
000016F0  4281                    1145              CLR.L   D1
000016F2  1039 0000275C           1146              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
000016F8  1200                    1147              MOVE.B  D0,D1
000016FA  5200                    1148              ADDQ.B  #1,D0                   ; D0 = CELL TO MOVE                   
000016FC  5301                    1149              SUBQ.B  #1,D1                   ; D1 = NEXT COLUNM AFTER SQUARE
000016FE                          1150              
000016FE  11B0 0000 1000          1151              MOVE.B  (A0,D0),(A0,D1)         ; COPY THE CELL CONTENT
00001704  4230 0000               1152              CLR.B   (A0,D0)                 ; CLEAR THE CELL CONTENT
00001708  0600 000A               1153              ADD.B   #MCOLUMN,D0             ; MOVE TO NEXT CELL TO MOVE
0000170C  0601 000A               1154              ADD.B   #MCOLUMN,D1             ; MOVE TO NEXT CELL TO SAVE
00001710  11B0 0000 1000          1155              MOVE.B  (A0,D0),(A0,D1)
00001716  4230 0000               1156              CLR.B   (A0,D0)
0000171A                          1157              
0000171A  0400 000C               1158              SUB.B   #MCOLUMN+2,D0           ; D0 = NEW FIGURE POINTER
0000171E  13C0 0000275C           1159              MOVE.B  D0,FIGPOSI              ; SAVES NEW FIGURE POINTER
00001724                          1160              
00001724  4CDF 0103               1161  .END        MOVEM.L (A7)+,D0-D1/A0
00001728  4E75                    1162              RTS
0000172A                          1163              
0000172A                          1164  ; -----------------------------------------------------------------------------
0000172A                          1165  RIGHTO
0000172A                          1166  ; CHECKS IF CAN GO FUTHER DOWN
0000172A                          1167  ; INPUT    - NONE
0000172A                          1168  ; OUTPUT   - NONE
0000172A                          1169  ; MODIFIES - NONE
0000172A                          1170  ; -----------------------------------------------------------------------------
0000172A                          1171              
0000172A  48E7 C080               1172              MOVEM.L D0-D1/A0,-(A7)
0000172E                          1173              
0000172E  4280                    1174              CLR.L   D0
00001730  4281                    1175              CLR.L   D1
00001732                          1176              
00001732  41F9 00002760           1177              LEA.L   HROW4,A0                ; A0 = START OF MATRIX
00001738  1039 0000275C           1178              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
0000173E                          1179              
0000173E                          1180              ; CHECK IF THERE IS END OF MATRIX TO THE LEFT
0000173E                          1181              
0000173E  3200                    1182              MOVE.W  D0,D1
00001740  0641 000A               1183              ADD.W   #MCOLUMN,D1
00001744  80FC 000A               1184              DIVU.W  #MCOLUMN,D0
00001748  4840                    1185              SWAP.W  D0
0000174A  B07C 0008               1186              CMP.W   #8,D0
0000174E  6600 0006               1187              BNE     .SKIP1
00001752  6000 0066               1188              BRA     .END
00001756  82FC 000A               1189  .SKIP1      DIVU.W  #MCOLUMN,D1
0000175A  4841                    1190              SWAP.W  D1
0000175C  B27C 0008               1191              CMP.W   #8,D1
00001760  6700 0058               1192              BEQ     .END
00001764                          1193  
00001764                          1194              ; CHECK IF THERE IS A FULL CELL TO THE LEFT
00001764                          1195              
00001764  4281                    1196              CLR.L   D1
00001766  4280                    1197              CLR.L   D0
00001768  1039 0000275C           1198              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
0000176E                          1199              
0000176E  5400                    1200              ADDQ.B  #2,D0
00001770  0830 0000 0000          1201              BTST.B  #0,(A0,D0)
00001776  6600 0042               1202              BNE     .END
0000177A  0600 000A               1203              ADD.B   #MCOLUMN,D0
0000177E  0830 0000 0000          1204              BTST.B  #0,(A0,D0)
00001784  6600 0034               1205              BNE     .END
00001788                          1206              
00001788                          1207              ; MOVES FIGURE TO THE LEFT BY ONE CELL
00001788                          1208              
00001788  4281                    1209              CLR.L   D1
0000178A  1039 0000275C           1210              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
00001790  1200                    1211              MOVE.B  D0,D1                
00001792  5401                    1212              ADDQ.B  #2,D1                   ; D1 = NEXT COLUNM AFTER SQUARE
00001794                          1213              
00001794  11B0 0000 1000          1214              MOVE.B  (A0,D0),(A0,D1)         ; COPY THE CELL CONTENT
0000179A  4230 0000               1215              CLR.B   (A0,D0)                 ; CLEAR THE CELL CONTENT
0000179E  0600 000A               1216              ADD.B   #MCOLUMN,D0             ; MOVE TO NEXT CELL TO MOVE
000017A2  0601 000A               1217              ADD.B   #MCOLUMN,D1             ; MOVE TO NEXT CELL TO SAVE
000017A6  11B0 0000 1000          1218              MOVE.B  (A0,D0),(A0,D1)
000017AC  4230 0000               1219              CLR.B   (A0,D0)
000017B0                          1220              
000017B0  0400 0009               1221              SUB.B   #MCOLUMN-1,D0           ; D0 = NEW FIGURE POINTER
000017B4  13C0 0000275C           1222              MOVE.B  D0,FIGPOSI              ; SAVES NEW FIGURE POINTER
000017BA                          1223              
000017BA  4CDF 0103               1224  .END        MOVEM.L (A7)+,D0-D1/A0
000017BE  4E75                    1225              RTS
000017C0                          1226              
000017C0                          1227  ; -----------------------------------------------------------------------------
000017C0                          1228  ROTATEO
000017C0                          1229  ; IT DOES NOT REQUIRED TO ROTATE
000017C0                          1230  ; INPUT    - NONE
000017C0                          1231  ; OUTPUT   - NONE
000017C0                          1232  ; MODIFIES - NONE
000017C0                          1233  ; -----------------------------------------------------------------------------
000017C0                          1234              
000017C0  4E75                    1235              RTS
000017C2                          1236  
000017C2                          1237  
000017C2                          1238  
000017C2                          1239  
000017C2                          1240  
000017C2                          1241  
000017C2                          1242  
000017C2                          1243  
000017C2                          1244  
000017C2                          1245  
000017C2                          1246  
000017C2                          1247  
000017C2                          1248  
000017C2                          1249  
000017C2                          1250  
000017C2                          1251  -------------------- end include --------------------
000017C2                          1252              INCLUDE "FIGURES/T.X68"   ; TETROMINO T
000017C2                          1253  ; =============================================================================
000017C2                          1254  ; TETROMINO T
000017C2                          1255  ; =============================================================================
000017C2                          1256  
000017C2                          1257  ; -----------------------------------------------------------------------------
000017C2                          1258  INITT
000017C2                          1259  ; ADDS A NEW SQUARE IN THE HIDEN ZONE OF THE MATRIX
000017C2                          1260  ; INPUT    - NONE
000017C2                          1261  ; OUTPUT   - NONE
000017C2                          1262  ; MODIFIES - MATRIX
000017C2                          1263  ; -----------------------------------------------------------------------------
000017C2                          1264              
000017C2  48E7 8080               1265              MOVEM.L D0/A0,-(A7)
000017C6  41F9 00002760           1266              LEA.L   HROW4,A0
000017CC  4280                    1267              CLR.L   D0
000017CE                          1268              
000017CE  103C 0018               1269              MOVE.B  #4+MCOLUMN*2,D0
000017D2  13C0 0000275C           1270              MOVE.B  D0,FIGPOSI
000017D8                          1271              
000017D8  11BC 0031 0000          1272              MOVE.B  #$31,(A0,D0)
000017DE  5280                    1273              ADDQ.L  #1,D0
000017E0  11BC 0031 0000          1274              MOVE.B  #$31,(A0,D0)
000017E6  0600 000A               1275              ADD.B   #MCOLUMN,D0
000017EA  11BC 0031 0000          1276              MOVE.B  #$31,(A0,D0)
000017F0  5380                    1277              SUBQ.L  #1,D0
000017F2  11BC 0031 0000          1278              MOVE.B  #$31,(A0,D0)
000017F8                          1279              
000017F8  4CDF 0101               1280              MOVEM.L (A7)+,D0/A0
000017FC  4E75                    1281              RTS
000017FE                          1282  
000017FE                          1283  ; -----------------------------------------------------------------------------
000017FE                          1284  DOWNT
000017FE                          1285  ; MOVES THE CURRENT SQUATE IN THE MATRIX
000017FE                          1286  ; INPUT    - NONE
000017FE                          1287  ; OUTPUT   - NONE
000017FE                          1288  ; MODIFIES - MATRIX
000017FE                          1289  ; -----------------------------------------------------------------------------
000017FE                          1290              
000017FE  48E7 E080               1291              MOVEM.L D0-D2/A0,-(A7)
00001802                          1292              
00001802  4280                    1293              CLR.L   D0
00001804                          1294              
00001804  41F9 00002760           1295              LEA.L   HROW4,A0                ; A0 = BEGIN OF MATRIX
0000180A  1039 0000275C           1296              MOVE.B  FIGPOSI,D0              ; D0 = START OF FIGURE
00001810                          1297              
00001810                          1298              ; CHECK IF IT CAN GO DOWN MORE
00001810                          1299              
00001810  0600 0014               1300              ADD.B   #MCOLUMN*2,D0           ; BOTTOM ROW AFTER THE SQUARE
00001814  B07C 00F0               1301              CMP     #MCOLUMN*MROW,D0        ; CHECK IF IS END OF MATRIX 
00001818  6400 0050               1302              BHS     .NEXT                   ; IF IT IS THEN GO TO NEXT
0000181C                          1303              
0000181C  323C 0001               1304              MOVE.W  #1,D1                   ; CREATE A COUNTER FOR LOOP
00001820                          1305              
00001820  1430 0000               1306  .LOOP       MOVE.B  (A0,D0),D2              ; MOVE CELL TO D2
00001824  0802 0000               1307              BTST.L  #0,D2                   ; CHECKS IF D2 IS FILLED
00001828  6700 0006               1308              BEQ     .SKIP                   ; IF NOT SKIP
0000182C  6000 003C               1309              BRA     .NEXT                   ; IF TRUE THEN NEXT
00001830  5200                    1310  .SKIP       ADDQ.B  #1,D0                   ; NEXT CELL TO CHECK
00001832  51C9 FFEC               1311              DBRA    D1,.LOOP                ; LOOP                   
00001836                          1312              
00001836                          1313              ; MOVES THE FIGURE DOWN BY ONE ROW
00001836                          1314              
00001836  4281                    1315              CLR.L   D1
00001838  1039 0000275C           1316              MOVE.B  FIGPOSI,D0              ; D0 = START OF FIGURE
0000183E  1200                    1317              MOVE.B  D0,D1                   
00001840  0601 0014               1318              ADD.B   #MCOLUMN*2,D1           ; D1 = CELL BELOW FIGURE
00001844                          1319              
00001844  11B0 0000 1000          1320              MOVE.B  (A0,D0),(A0,D1)         ; MOVE CONTENT BETWEEN CELLS
0000184A  4230 0000               1321              CLR.B   (A0,D0)                 ; CLEARS TOP CELL
0000184E  5200                    1322              ADDQ.B  #1,D0                   ; DO = SECOND CELL
00001850  5201                    1323              ADDQ.B  #1,D1                   ; D1 = FOURTH CELL
00001852  11B0 0000 1000          1324              MOVE.B  (A0,D0),(A0,D1)
00001858  4230 0000               1325              CLR.B   (A0,D0)
0000185C                          1326              
0000185C  0600 0009               1327              ADD.B   #MCOLUMN-1,D0           ; D0 = NEW FIGURE POINTER
00001860  13C0 0000275C           1328              MOVE.B  D0,FIGPOSI              ; SAVES NEW FIGURE POINTER
00001866  6000 000A               1329              BRA     .END
0000186A                          1330              
0000186A  13FC 0001 0000275D      1331  .NEXT       MOVE.B  #1,FIGLDOW              ; CHANGES FIGLDOW TO YES (1)
00001872  4CDF 0107               1332  .END        MOVEM.L (A7)+,D0-D2/A0
00001876  4E75                    1333              RTS
00001878                          1334  
00001878                          1335  ; -----------------------------------------------------------------------------
00001878                          1336  LEFTT
00001878                          1337  ; CHECKS IF CAN GO FUTHER DOWN
00001878                          1338  ; INPUT    - NONE
00001878                          1339  ; OUTPUT   - NONE
00001878                          1340  ; MODIFIES - NONE
00001878                          1341  ; -----------------------------------------------------------------------------
00001878                          1342              
00001878  48E7 C080               1343              MOVEM.L D0-D1/A0,-(A7)
0000187C                          1344              
0000187C  4280                    1345              CLR.L   D0
0000187E  4281                    1346              CLR.L   D1
00001880                          1347              
00001880  41F9 00002760           1348              LEA.L   HROW4,A0                ; A0 = START OF MATRIX
00001886  1039 0000275C           1349              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
0000188C                          1350              
0000188C                          1351              ; CHECK IF THERE IS END OF MATRIX TO THE LEFT
0000188C                          1352              
0000188C  3200                    1353              MOVE.W  D0,D1
0000188E  0641 000A               1354              ADD.W   #MCOLUMN,D1
00001892  80FC 000A               1355              DIVU.W  #MCOLUMN,D0
00001896  4840                    1356              SWAP.W  D0
00001898  4A40                    1357              TST.W   D0
0000189A  6600 0006               1358              BNE     .SKIP1
0000189E  6000 0066               1359              BRA     .END
000018A2  82FC 000A               1360  .SKIP1      DIVU.W  #MCOLUMN,D1
000018A6  4841                    1361              SWAP.W  D1
000018A8  4A41                    1362              TST.W   D1
000018AA  6700 005A               1363              BEQ     .END
000018AE                          1364              
000018AE                          1365              ; CHECK IF THERE IS A FULL CELL TO THE LEFT
000018AE                          1366              
000018AE  4281                    1367              CLR.L   D1
000018B0  4280                    1368              CLR.L   D0
000018B2  1039 0000275C           1369              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
000018B8                          1370              
000018B8  5300                    1371              SUBQ.B  #1,D0
000018BA  0830 0000 0000          1372              BTST.B  #0,(A0,D0)
000018C0  6600 0044               1373              BNE     .END
000018C4  0600 000A               1374              ADD.B   #MCOLUMN,D0
000018C8  0830 0000 0000          1375              BTST.B  #0,(A0,D0)
000018CE  6600 0036               1376              BNE     .END
000018D2                          1377              
000018D2                          1378              ; MOVES FIGURE TO THE LEFT BY ONE CELL
000018D2                          1379              
000018D2  4281                    1380              CLR.L   D1
000018D4  1039 0000275C           1381              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
000018DA  1200                    1382              MOVE.B  D0,D1
000018DC  5200                    1383              ADDQ.B  #1,D0                   ; D0 = CELL TO MOVE                   
000018DE  5301                    1384              SUBQ.B  #1,D1                   ; D1 = NEXT COLUNM AFTER SQUARE
000018E0                          1385              
000018E0  11B0 0000 1000          1386              MOVE.B  (A0,D0),(A0,D1)         ; COPY THE CELL CONTENT
000018E6  4230 0000               1387              CLR.B   (A0,D0)                 ; CLEAR THE CELL CONTENT
000018EA  0600 000A               1388              ADD.B   #MCOLUMN,D0             ; MOVE TO NEXT CELL TO MOVE
000018EE  0601 000A               1389              ADD.B   #MCOLUMN,D1             ; MOVE TO NEXT CELL TO SAVE
000018F2  11B0 0000 1000          1390              MOVE.B  (A0,D0),(A0,D1)
000018F8  4230 0000               1391              CLR.B   (A0,D0)
000018FC                          1392              
000018FC  0400 000C               1393              SUB.B   #MCOLUMN+2,D0           ; D0 = NEW FIGURE POINTER
00001900  13C0 0000275C           1394              MOVE.B  D0,FIGPOSI              ; SAVES NEW FIGURE POINTER
00001906                          1395              
00001906  4CDF 0103               1396  .END        MOVEM.L (A7)+,D0-D1/A0
0000190A  4E75                    1397              RTS
0000190C                          1398              
0000190C                          1399  ; -----------------------------------------------------------------------------
0000190C                          1400  RIGHTT
0000190C                          1401  ; CHECKS IF CAN GO FUTHER DOWN
0000190C                          1402  ; INPUT    - NONE
0000190C                          1403  ; OUTPUT   - NONE
0000190C                          1404  ; MODIFIES - NONE
0000190C                          1405  ; -----------------------------------------------------------------------------
0000190C                          1406              
0000190C  48E7 C080               1407              MOVEM.L D0-D1/A0,-(A7)
00001910                          1408              
00001910  4280                    1409              CLR.L   D0
00001912  4281                    1410              CLR.L   D1
00001914                          1411              
00001914  41F9 00002760           1412              LEA.L   HROW4,A0                ; A0 = START OF MATRIX
0000191A  1039 0000275C           1413              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
00001920                          1414              
00001920                          1415              ; CHECK IF THERE IS END OF MATRIX TO THE LEFT
00001920                          1416              
00001920  3200                    1417              MOVE.W  D0,D1
00001922  0641 000A               1418              ADD.W   #MCOLUMN,D1
00001926  80FC 000A               1419              DIVU.W  #MCOLUMN,D0
0000192A  4840                    1420              SWAP.W  D0
0000192C  B07C 0008               1421              CMP.W   #8,D0
00001930  6600 0006               1422              BNE     .SKIP1
00001934  6000 0066               1423              BRA     .END
00001938  82FC 000A               1424  .SKIP1      DIVU.W  #MCOLUMN,D1
0000193C  4841                    1425              SWAP.W  D1
0000193E  B27C 0008               1426              CMP.W   #8,D1
00001942  6700 0058               1427              BEQ     .END
00001946                          1428  
00001946                          1429              ; CHECK IF THERE IS A FULL CELL TO THE LEFT
00001946                          1430              
00001946  4281                    1431              CLR.L   D1
00001948  4280                    1432              CLR.L   D0
0000194A  1039 0000275C           1433              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
00001950                          1434              
00001950  5400                    1435              ADDQ.B  #2,D0
00001952  0830 0000 0000          1436              BTST.B  #0,(A0,D0)
00001958  6600 0042               1437              BNE     .END
0000195C  0600 000A               1438              ADD.B   #MCOLUMN,D0
00001960  0830 0000 0000          1439              BTST.B  #0,(A0,D0)
00001966  6600 0034               1440              BNE     .END
0000196A                          1441              
0000196A                          1442              ; MOVES FIGURE TO THE LEFT BY ONE CELL
0000196A                          1443              
0000196A  4281                    1444              CLR.L   D1
0000196C  1039 0000275C           1445              MOVE.B  FIGPOSI,D0              ; D0 = FIGURE POSITION
00001972  1200                    1446              MOVE.B  D0,D1                
00001974  5401                    1447              ADDQ.B  #2,D1                   ; D1 = NEXT COLUNM AFTER SQUARE
00001976                          1448              
00001976  11B0 0000 1000          1449              MOVE.B  (A0,D0),(A0,D1)         ; COPY THE CELL CONTENT
0000197C  4230 0000               1450              CLR.B   (A0,D0)                 ; CLEAR THE CELL CONTENT
00001980  0600 000A               1451              ADD.B   #MCOLUMN,D0             ; MOVE TO NEXT CELL TO MOVE
00001984  0601 000A               1452              ADD.B   #MCOLUMN,D1             ; MOVE TO NEXT CELL TO SAVE
00001988  11B0 0000 1000          1453              MOVE.B  (A0,D0),(A0,D1)
0000198E  4230 0000               1454              CLR.B   (A0,D0)
00001992                          1455              
00001992  0400 0009               1456              SUB.B   #MCOLUMN-1,D0           ; D0 = NEW FIGURE POINTER
00001996  13C0 0000275C           1457              MOVE.B  D0,FIGPOSI              ; SAVES NEW FIGURE POINTER
0000199C                          1458              
0000199C  4CDF 0103               1459  .END        MOVEM.L (A7)+,D0-D1/A0
000019A0  4E75                    1460              RTS
000019A2                          1461              
000019A2                          1462  ; -----------------------------------------------------------------------------
000019A2                          1463  ROTATET
000019A2                          1464  ; IT DOES NOT REQUIRED TO ROTATE
000019A2                          1465  ; INPUT    - NONE
000019A2                          1466  ; OUTPUT   - NONE
000019A2                          1467  ; MODIFIES - NONE
000019A2                          1468  ; -----------------------------------------------------------------------------
000019A2                          1469              
000019A2  4E75                    1470              RTS
000019A4                          1471  
000019A4                          1472  
000019A4                          1473  
000019A4                          1474  
000019A4                          1475  
000019A4                          1476  
000019A4                          1477  
000019A4                          1478  
000019A4                          1479  
000019A4                          1480  
000019A4                          1481  
000019A4                          1482  
000019A4                          1483  
000019A4                          1484  
000019A4                          1485  
000019A4                          1486  -------------------- end include --------------------
000019A4                          1487  
000019A4                          1488  ; -----------------------------------------------------------------------------
000019A4                          1489  INITFIGURE
000019A4                          1490  ; ADDS A NEW FIGURE IN THE HIDEN ZONE OF THE MATRIX
000019A4                          1491  ; INPUT    - NONE
000019A4                          1492  ; OUTPUT   - NONE
000019A4                          1493  ; MODIFIES - MATRIX
000019A4                          1494  ; -----------------------------------------------------------------------------
000019A4                          1495              
000019A4  48E7 8080               1496              MOVEM.L D0/A0,-(A7)
000019A8                          1497  
000019A8  4239 0000275D           1498              CLR.B   FIGLDOW
000019AE  4239 0000275E           1499              CLR.B   FIGLRIG
000019B4  4239 0000275F           1500              CLR.B   FIGLLEF
000019BA                          1501              
000019BA  4280                    1502              CLR.L   D0
000019BC  13C0 0000275A           1503              MOVE.B  D0,FIGTYPE              ; AADIR D0 LUEGO
000019C2                          1504              
000019C2  41F9 000019D4           1505              LEA.L   .DATA,A0             
000019C8  2070 0000               1506              MOVEA.L (A0,D0),A0
000019CC                          1507              
000019CC  4E90                    1508              JSR     (A0)                      
000019CE                          1509              
000019CE  4CDF 0101               1510              MOVEM.L (A7)+,D0/A0
000019D2  4E75                    1511              RTS
000019D4                          1512              
000019D4= 000015E0 000017C2       1513  .DATA       DC.L    INITO, INITT
000019DC                          1514              
000019DC                          1515  ; -----------------------------------------------------------------------------
000019DC                          1516  LEFTFIGURE
000019DC                          1517  ; EXECUTES A FIGURE LEFT MOVEMENT
000019DC                          1518  ; INPUT    - NONE
000019DC                          1519  ; OUTPUT   - NONE
000019DC                          1520  ; MODIFIES - MATRIX
000019DC                          1521  ; -----------------------------------------------------------------------------
000019DC                          1522              
000019DC                          1523              
000019DC  48E7 8080               1524              MOVEM.L D0/A0,-(A7)
000019E0                          1525              
000019E0  4280                    1526              CLR.L   D0
000019E2  1039 0000275A           1527              MOVE.B  FIGTYPE,D0
000019E8                          1528              
000019E8  41F9 000019FA           1529              LEA.L   .DATA,A0             
000019EE  2070 0000               1530              MOVEA.L (A0,D0),A0
000019F2                          1531              
000019F2  4E90                    1532              JSR     (A0)
000019F4                          1533              
000019F4  4CDF 0101               1534              MOVEM.L (A7)+,D0/A0
000019F8  4E75                    1535              RTS
000019FA                          1536              
000019FA= 00001696 00001878       1537  .DATA       DC.L    LEFTO, LEFTT
00001A02                          1538              
00001A02                          1539  ; -----------------------------------------------------------------------------
00001A02                          1540  RIGHTFIGURE
00001A02                          1541  ; ADDS A NEW SQUARE IN THE HIDEN ZONE OF THE MATRIX
00001A02                          1542  ; INPUT    - NONE
00001A02                          1543  ; OUTPUT   - NONE
00001A02                          1544  ; MODIFIES - MATRIX
00001A02                          1545  ; -----------------------------------------------------------------------------
00001A02                          1546                          
00001A02  48E7 8080               1547              MOVEM.L D0/A0,-(A7)
00001A06                          1548              
00001A06  4280                    1549              CLR.L   D0
00001A08  1039 0000275A           1550              MOVE.B  FIGTYPE,D0
00001A0E                          1551              
00001A0E  41F9 00001A20           1552              LEA.L   .DATA,A0             
00001A14  2070 0000               1553              MOVEA.L (A0,D0),A0
00001A18                          1554              
00001A18  4E90                    1555              JSR     (A0)
00001A1A                          1556              
00001A1A  4CDF 0101               1557              MOVEM.L (A7)+,D0/A0
00001A1E  4E75                    1558              RTS
00001A20                          1559              
00001A20= 0000172A 0000190C       1560  .DATA       DC.L    RIGHTO, RIGHTT
00001A28                          1561              
00001A28                          1562  ; -----------------------------------------------------------------------------
00001A28                          1563  ROTATEFIGURE
00001A28                          1564  ; ADDS A NEW SQUARE IN THE HIDEN ZONE OF THE MATRIX
00001A28                          1565  ; INPUT    - NONE
00001A28                          1566  ; OUTPUT   - NONE
00001A28                          1567  ; MODIFIES - MATRIX
00001A28                          1568  ; -----------------------------------------------------------------------------
00001A28                          1569              
00001A28  48E7 8080               1570              MOVEM.L D0/A0,-(A7)
00001A2C                          1571              
00001A2C  4280                    1572              CLR.L   D0
00001A2E  1039 0000275A           1573              MOVE.B  FIGTYPE,D0
00001A34                          1574              
00001A34  41F9 00001A46           1575              LEA.L   .DATA,A0             
00001A3A  2070 0000               1576              MOVEA.L (A0,D0),A0
00001A3E                          1577              
00001A3E  4E90                    1578              JSR     (A0)
00001A40                          1579              
00001A40  4CDF 0101               1580              MOVEM.L (A7)+,D0/A0
00001A44  4E75                    1581              RTS
00001A46                          1582              
00001A46= 000017C0 000019A2       1583  .DATA       DC.L    ROTATEO, ROTATET
00001A4E                          1584              
00001A4E                          1585  ; -----------------------------------------------------------------------------
00001A4E                          1586  DOWNFIGURE
00001A4E                          1587  ; ADDS A NEW SQUARE IN THE HIDEN ZONE OF THE MATRIX
00001A4E                          1588  ; INPUT    - NONE
00001A4E                          1589  ; OUTPUT   - NONE
00001A4E                          1590  ; MODIFIES - MATRIX
00001A4E                          1591  ; -----------------------------------------------------------------------------
00001A4E                          1592              
00001A4E  48E7 8080               1593              MOVEM.L D0/A0,-(A7)
00001A52                          1594              
00001A52  4280                    1595              CLR.L   D0
00001A54  1039 0000275A           1596              MOVE.B  FIGTYPE,D0
00001A5A                          1597              
00001A5A  41F9 00001A6C           1598              LEA.L   .DATA,A0             
00001A60  2070 0000               1599              MOVEA.L (A0,D0),A0
00001A64                          1600              
00001A64  4E90                    1601              JSR     (A0)
00001A66                          1602              
00001A66  4CDF 0101               1603              MOVEM.L (A7)+,D0/A0
00001A6A  4E75                    1604              RTS
00001A6C                          1605              
00001A6C= 0000161C 000017FE       1606  .DATA       DC.L    DOWNO, DOWNT
00001A74                          1607  
00001A74                          1608  
00001A74                          1609  
00001A74                          1610  
00001A74                          1611  
00001A74                          1612  
00001A74                          1613  
00001A74                          1614  
00001A74                          1615  
00001A74                          1616  
00001A74                          1617  
00001A74                          1618  
00001A74                          1619  
00001A74                          1620  
00001A74                          1621  
00001A74                          1622  
00001A74                          1623  
00001A74                          1624  
00001A74                          1625  
00001A74                          1626  
00001A74                          1627  
00001A74                          1628  -------------------- end include --------------------
00001A74                          1629              
00001A74                          1630  ; --- INITIALIZE --------------------------------------------------------------
00001A74                          1631  
00001A74  4EB8 1000               1632  START       JSR     SYSINIT
00001A78  4EB8 13EE               1633              JSR     STAINIT                 ; INITIALIZE STATES
00001A7C                          1634              
00001A7C                          1635  ; --- UPDATE ------------------------------------------------------------------
00001A7C                          1636  
00001A7C  4E40                    1637  .LOOP       TRAP    #KBDTRAP                ; READ KEYBOARD
00001A7E  2279 00002756           1638              MOVE.L  STATE,A1
00001A84  4E91                    1639              JSR     (A1)                    ; JUMPS TO NEXT STATE
00001A86                          1640              
00001A86                          1641  ; --- WAIT SYNCH --------------------------------------------------------------
00001A86                          1642  
00001A86  4A39 00001A9E           1643  .WINT       TST.B   (SCRINTCT)              ; WAIT FOR INTERRUPT
00001A8C  67F8                    1644              BEQ     .WINT
00001A8E  4239 00001A9E           1645              CLR.B   (SCRINTCT)
00001A94                          1646  
00001A94                          1647  ; --- PLOT --------------------------------------------------------------------
00001A94                          1648           
00001A94  4E41                    1649              TRAP    #SCRTRAP                ; SHOW GRAPHICS
00001A96  60E4                    1650              BRA     .LOOP
00001A98  FFFF FFFF               1651              SIMHALT
00001A9C                          1652  
00001A9C                          1653  ; --- VARIABLES ---------------------------------------------------------------
00001A9C                          1654  
00001A9C                          1655              INCLUDE "SYSTEM/SYSVAR.X68"
00001A9C                          1656  ; =============================================================================
00001A9C                          1657  ; SYSTEM VARS
00001A9C                          1658  ; NOTE THAT ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO USER. THUS
00001A9C                          1659  ; THEY MUST NOT BE IN PROTECTED MEMORY.
00001A9C                          1660  ; NOTE THAT USING DMMDATA IN SUCH WAY IS A BAD IDEA, AS USER APPLICATIONS CAN
00001A9C                          1661  ; ALSO FREE OR CHANGE OWNERSHIP. NONETHELESS, FOR THE SAKE OF THIS EXAMPLE
00001A9C                          1662  ; THIS IS GOOD ENOUGH.
00001A9C                          1663  ; =============================================================================
00001A9C                          1664  
00001A9C                          1665  ; --- KEYBOARD RELATED VARIABLES ----------------------------------------------
00001A9C                          1666  
00001A9C                          1667  KBDVAL      DS.B    1                       ; KEY PRESSED=1
00001A9D                          1668  KBDEDGE     DS.B    1                       ; KEY CHANGED=1
00001A9E                          1669  
00001A9E                          1670              DS.W    0
00001A9E                          1671  
00001A9E                          1672  ; --- SCREEN RELATED VARIABLES ------------------------------------------------
00001A9E                          1673  
00001A9E                          1674  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER/FLAG
00001A9F                          1675  SCRCYCCT    DS.B    1                       ; CYCLE COUNTER
00001AA0                          1676              DS.W    0
00001AA0                          1677  
00001AA0                          1678  ; --- DYNAMIC MEMORY VARIABLES ------------------------------------------------
00001AA0                          1679  
00001AC0                          1680              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00001AC0                          1681  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
00002740                          1682              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
00002740                          1683  
00002740                          1684  
00002740                          1685  -------------------- end include --------------------
00002740                          1686              INCLUDE "GAME/VAR.X68"
00002740                          1687  ; =============================================================================
00002740                          1688  ; GAME VARS
00002740                          1689  ; =============================================================================
00002740                          1690  
00002740                          1691  ; --- GAME STATUS RELATED VARIABLES -------------------------------------------
00002740                          1692  
00002740= 01                      1693  GAMEOVER    DC.B    1                       ; 1 IF IT IS A GAMEOVER
00002741                          1694  
00002741                          1695  ; --- GAME STATE RELATED VARIABLES --------------------------------------------
00002741                          1696  
00002742= 000013EE                1697  STATES      DC.L    STAINIT                 ; INITALIZE STATE   0
00002746= 000013FE                1698              DC.L    STANMME                 ; MAIN MENU STATE   1
0000274A= 0000141E                1699              DC.L    STANWGM                 ; NEW GAME STATE    2     
0000274E= 00001452                1700              DC.L    STAUPDA                 ; GAME UPDATE STATE 3
00002752= 00001514                1701              DC.L    STAGMOV                 ; GAME OVER STATE   4
00002756                          1702              
00002756                          1703  STATE      DS.L    1                        ; ACTIVE STATE
0000275A                          1704  
0000275A                          1705  ; --- FIGURE RELATED VARIABLES ------------------------------------------------
0000275A                          1706  
0000275A                          1707  FIGTYPE     DS.B    1                       ; CURRENT FIGURE
0000275B                          1708  FIGROTA     DS.B    1                       ; CURRENT ROTATION
0000275C                          1709  FIGPOSI     DS.B    1                       ; CURRENT POSITION
0000275D                          1710  FIGLDOW     DS.B    1                       ; 1 IF CAN NOT GO DOWN
0000275E                          1711  FIGLRIG     DS.B    1                       ; 1 IF CAN NOT GO RIGHT
0000275F                          1712  FIGLLEF     DS.B    1                       ; 1 IF CAN NOT GO LEFT
00002760                          1713  
00002760                          1714  ; --- MATRIX RELATED VARIABLES ------------------------------------------------
00002760                          1715  
00002760                          1716  HROW4       DS.B    MCOLUMN                 ; ALL THE HROWS WILL NOT SHOW ON  
0000276A                          1717  HROW3       DS.B    MCOLUMN                 ; THE SCREEN (HIDDEN)
00002774                          1718  HROW2       DS.B    MCOLUMN                 
0000277E                          1719  HROW1       DS.B    MCOLUMN                 
00002788                          1720  ROW0        DS.B    MCOLUMN
00002792                          1721  ROW1        DS.B    MCOLUMN
0000279C                          1722  ROW2        DS.B    MCOLUMN
000027A6                          1723  ROW3        DS.B    MCOLUMN
000027B0                          1724  ROW4        DS.B    MCOLUMN
000027BA                          1725  ROW5        DS.B    MCOLUMN
000027C4                          1726  ROW6        DS.B    MCOLUMN
000027CE                          1727  ROW7        DS.B    MCOLUMN
000027D8                          1728  ROW8        DS.B    MCOLUMN
000027E2                          1729  ROW9        DS.B    MCOLUMN
000027EC                          1730  ROW10       DS.B    MCOLUMN
000027F6                          1731  ROW11       DS.B    MCOLUMN
00002800                          1732  ROW12       DS.B    MCOLUMN
0000280A                          1733  ROW13       DS.B    MCOLUMN
00002814                          1734  ROW14       DS.B    MCOLUMN
0000281E                          1735  ROW15       DS.B    MCOLUMN
00002828                          1736  ROW16       DS.B    MCOLUMN
00002832                          1737  ROW17       DS.B    MCOLUMN
0000283C                          1738  ROW18       DS.B    MCOLUMN
00002846                          1739  ROW19       DS.B    MCOLUMN
00002850                          1740              
00002850                          1741  ; --- COLOR RELATED VARIABLES -------------------------------------------------
00002850                          1742           
00002850                          1743  ACOLOR      DS.B    1
00002852                          1744              DS.W    0
00002852                          1745              
00002852= 00FFFF00                1746  COLOR       DC.L    $00FFFF00              ; CIAN 
00002856= 00FF0400                1747              DC.L    $00FF0400              ; BLUE
0000285A= 00008CFF                1748              DC.L    $00008CFF              ; ORANGE
0000285E= 0000FBFF                1749              DC.L    $0000FBFF              ; YELLOW
00002862= 001AFF00                1750              DC.L    $001AFF00              ; GREEN
00002866= 00FF0095                1751              DC.L    $00FF0095              ; PURPLE
0000286A= 000000FF                1752              DC.L    $000000FF              ; RED
0000286A= 000000FF                1753  -------------------- end include --------------------
0000286E                          1754              
0000286E                          1755              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
ACOLOR              2850
CHFILLCL            1380
CHPENCL             1374
COLOR               2852
DMMALLOC            11AC
DMMALLOC:END        11C4
DMMBNUM             32
DMMBSIZE            40
DMMDATA             1AC0
DMMFCOM             1186
DMMFFND             1194
DMMFIRST            113C
DMMFLOOP            117A
DMMFRCOM            114E
DMMFREE             11C6
DMMFRFND            115C
DMMFRLOP            1142
DMMFRSTO            1174
DMMINIT             111A
DMMINIT:LOOP        1128
DMMNEXT             115E
DMMNEXTO            1196
DMMSYSID            0
DOWNFIGURE          1A4E
DOWNFIGURE:DATA     1A6C
DOWNO               161C
DOWNO:END           1690
DOWNO:LOOP          163E
DOWNO:NEXT          1688
DOWNO:SKIP          164E
DOWNT               17FE
DOWNT:END           1872
DOWNT:LOOP          1820
DOWNT:NEXT          186A
DOWNT:SKIP          1830
DRAWCELL            1342
DRAWGAME            1242
DRAWGAMEOVER        1278
DRAWGAMEOVER:TEXT1  12B6
DRAWGAMEOVER:TEXT2  12C0
DRAWMATRIX          12E0
DRAWMATRIX:LOOP     12F6
DRAWMATRIX:SKIP1    1326
DRAWMATRIX:SKIP2    1334
DRAWMENU            11DC
DRAWMENU:TEXT1      121A
DRAWMENU:TEXT2      1221
DRAWTEXT            138C
DRAWTEXT:LOOP       1394
FIGLDOW             275D
FIGLLEF             275F
FIGLRIG             275E
FIGPOSI             275C
FIGROTA             275B
FIGTYPE             275A
GAMEOVER            2740
GETCURSOR           13B4
HROW1               277E
HROW2               2774
HROW3               276A
HROW4               2760
INITFIGURE          19A4
INITFIGURE:DATA     19D4
INITMATRIX          13C8
INITMATRIX:LOOP     13D8
INITO               15E0
INITT               17C2
ISFILLED            1
ISGAMEOVER          151A
ISGAMEOVER:END      1540
ISGAMEOVER:LOOP     1526
ISGAMEOVER:SKIP     1538
ISRDOWN             2
ISRMOVEDOWN         13E6
ISTETRIS            1546
ISTETRIS:CLEAN      157E
ISTETRIS:EXIT       15DA
ISTETRIS:LOOP1      156A
ISTETRIS:LOOP2      1582
ISTETRIS:LOOP3      15A6
ISTETRIS:LOOP4      15CE
ISTETRIS:MOVE       15C0
ISTETRIS:NEXT1      155C
ISTETRIS:PREMOVE    15B8
ISTETRIS:START      1568
KBDBITDN            3
KBDBITF1            4
KBDBITF2            5
KBDBITF3            6
KBDBITLF            0
KBDBITPS            7
KBDBITRT            2
KBDBITUP            1
KBDCHRDN            28
KBDCHRLF            25
KBDCHRMK            4D
KBDCHRPK            50
KBDCHRRT            27
KBDCHRSH            10
KBDCHRSP            20
KBDCHRUP            26
KBDDOWN             28
KBDEDGE             1A9D
KBDFIRE1            20
KBDFIRE2            4D
KBDFIRE3            10
KBDINIT             10A8
KBDLEFT             25
KBDMSKDN            8
KBDMSKF1            10
KBDMSKF2            20
KBDMSKF3            40
KBDMSKLF            1
KBDMSKPS            80
KBDMSKRT            4
KBDMSKUP            2
KBDPAUSE            50
KBDREAD             10BE
KBDREAD:LOOP        10EC
KBDREAD:SKIP        1102
KBDRIGHT            27
KBDTRAP             0
KBDUP               26
KBDVAL              1A9C
LEFTFIGURE          19DC
LEFTFIGURE:DATA     19FA
LEFTO               1696
LEFTO:END           1724
LEFTO:SKIP1         16C0
LEFTT               1878
LEFTT:END           1906
LEFTT:SKIP1         18A2
MCOLUMN             A
MROW                18
RIGHTFIGURE         1A02
RIGHTFIGURE:DATA    1A20
RIGHTO              172A
RIGHTO:END          17BA
RIGHTO:SKIP1        1756
RIGHTT              190C
RIGHTT:END          199C
RIGHTT:SKIP1        1938
ROTATEFIGURE        1A28
ROTATEFIGURE:DATA   1A46
ROTATEO             17C0
ROTATET             19A2
ROW0                2788
ROW1                2792
ROW10               27EC
ROW11               27F6
ROW12               2800
ROW13               280A
ROW14               2814
ROW15               281E
ROW16               2828
ROW17               2832
ROW18               283C
ROW19               2846
ROW2                279C
ROW3                27A6
ROW4                27B0
ROW5                27BA
ROW6                27C4
ROW7                27CE
ROW8                27D8
ROW9                27E2
SCRCYCCT            1A9F
SCRHEIGH            2BC
SCRINIT             101C
SCRINTCT            1A9E
SCRIRQ              1
SCRISR              1088
SCRTIM              14
SCRTRAP             1
SCRUPD              1096
SCRWIDTH            3E8
SETCURSOR           13A0
SIDELENGTH          1E
STAGMOV             1514
STAINIT             13EE
STANMME             13FE
STANMME:END         141C
STANWGM             141E
START               1A74
START:LOOP          1A7C
START:WINT          1A86
STATE               2756
STATES              2742
STAUPDA             1452
STAUPDA:DOWN        14A6
STAUPDA:END         1510
STAUPDA:GAMEOVER    14FE
STAUPDA:LEFT        1482
STAUPDA:RIGHT       1494
STAUPDA:SPACE       14CA
STAUPDA:TEMPMOVE    14E6
STAUPDA:UP          14B8
SYSINIT             1000
WHATCOLOR           F0
XMATRIX             15E
YMATRIX             32
